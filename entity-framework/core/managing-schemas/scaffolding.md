---
title: Реконструирование — EF Core
author: bricelam
ms.author: bricelam
ms.date: 11/13/2018
ms.assetid: 6263EF7D-4989-42E6-BDEE-45DA770342FB
uid: core/managing-schemas/scaffolding
ms.openlocfilehash: 6e61d2ebcf5ada365dcdb264bc371199574e12fa
ms.sourcegitcommit: 33b2e84dae96040f60a613186a24ff3c7b00b6db
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/21/2019
ms.locfileid: "56459189"
---
# <a name="reverse-engineering"></a>Реконструирование

Реконструирование — это процесс формирования шаблонов классы типов сущностей и класс DbContext, основанный на схему базы данных. Он может быть выполнена с использованием `Scaffold-DbContext` команды консоли диспетчера пакетов (PMC) Core EF средств или `dotnet ef dbcontext scaffold` команды средства интерфейса командной строки (CLI) .NET.

## <a name="installing"></a>Установка

Для реконструирования, потребуется установить [инструменты PMC](xref:core/miscellaneous/cli/powershell) (только для Visual Studio) или [средств интерфейса командной строки](xref:core/miscellaneous/cli/dotnet). См. сведения о ресурсах.

Кроме того, потребуется установить соответствующий [поставщик базы данных](xref:core/providers/index) для реконструирования схемы базы данных.

## <a name="connection-string"></a>Строка подключения

Первый аргумент для команды является строка подключения к базе данных. Средства будет использовать эту строку подключения для чтения схемы базы данных.

Как заключения в кавычки и escape-строку подключения зависит от того какой оболочки используется для выполнения команды. К документации в оболочке конкретные сведения. Например, PowerShell, которые необходимо экранировать `$` символов, но не `\`.

``` powershell
Scaffold-DbContext 'Data Source=(localdb)\MSSQLLocalDB;Initial Catalog=Chinook' Microsoft.EntityFrameworkCore.SqlServer
```

``` Console
dotnet ef dbcontext scaffold "Data Source=(localdb)\MSSQLLocalDB;Initial Catalog=Chinook" Microsoft.EntityFrameworkCore.SqlServer
```

### <a name="configuration-and-user-secrets"></a>Конфигурация и секреты пользователя

Если у вас есть проект ASP.NET Core, можно использовать `Name=<connection-string>` синтаксис для чтения строку подключения из конфигурации.

Это хорошо работает с [средство Secret Manager](https://docs.microsoft.com/aspnet/core/security/app-secrets#secret-manager) чтобы хранить пароль базы данных отдельно от базы кода.

``` Console
dotnet user-secrets set ConnectionStrings.Chinook "Data Source=(localdb)\MSSQLLocalDB;Initial Catalog=Chinook"
dotnet ef dbcontext scaffold Name=Chinook Microsoft.EntityFrameworkCore.SqlServer
```

## <a name="provider-name"></a>Имя поставщика

Вторым аргументом является имя поставщика. Имя поставщика обычно совпадает имя пакета NuGet поставщика.

## <a name="specifying-tables"></a>Определение таблиц

Все таблицы в схеме базы данных являются обратного разработанная в виде типов сущностей по умолчанию. Можно ограничить, какие таблицы обратного спроектировали путем указания схемы и таблицы.

`-Schemas` Параметр в PMC и `--schema` параметр в интерфейсе командной строки можно использовать для включения каждой таблицы в схеме.

`-Tables` (PMC) и `--table` (CLI) можно использовать для включения определенных таблиц.

Чтобы включить несколько таблиц в PMC, используйте массив.

``` powershell
Scaffold-DbContext ... -Tables Artist, Album
```

Чтобы включить несколько таблиц в интерфейсе командной строки, укажите параметр несколько раз.

``` Console
dotnet ef dbcontext scaffold ... --table Artist --table Album
```

## <a name="preserving-names"></a>Сохранение имен

Имена таблиц и столбцов фиксируются лучше соответствовать соглашениям об именовании .NET для типов и свойств по умолчанию. Указание `-UseDatabaseNames` перейдите в консоли диспетчера пакетов или `--use-database-names` параметр в интерфейсе командной строки будет отключить это поведение, сохраняя исходные имена базы данных как можно больше. Недопустимые идентификаторы .NET будет по-прежнему исправлена и Синтезированная имена, такие как свойства навигации по-прежнему будет соответствовать соглашениям об именовании .NET для.

## <a name="fluent-api-or-data-annotations"></a>Fluent API или заметки к данным

Типы сущностей настраиваются с помощью Fluent API по умолчанию. Укажите `-DataAnnotations` (PMC) или `--data-annotations` (CLI), чтобы вместо этого используйте аннотации данных, если это возможно.

Например с помощью Fluent API будет формировать на это:

``` csharp
entity.Property(e => e.Title)
    .IsRequired()
    .HasMaxLength(160);
```

При использовании заметок к данным будет формировать это:

``` csharp
[Required]
[StringLength(160)]
public string Title { get; set; }
```

## <a name="dbcontext-name"></a>Имя DbContext

Шаблонный DbContext класс будет называться имя базы данных, заканчивающиеся *контекст* по умолчанию. Чтобы указать другую, используйте `-Context` в PMC и `--context` в интерфейсе командной строки.

## <a name="directories-and-namespaces"></a>Каталоги и пространства имен

Классы сущностей и класс DbContext сформированные в корневой каталог проекта и использовать пространство имен по умолчанию проекта. Можно указать каталог, где это классы сформированные с помощью `-OutputDir` (PMC) или `--output-dir` (CLI). Пространство имен будет корневое пространство имен, а также имена всех подкаталогах, в корневом каталоге проекта.

Можно также использовать `-ContextDir` (PMC) и `--context-dir` (CLI) для формирования шаблонов класса DbContext в отдельный каталог из классы типов сущностей.

``` powershell
Scaffold-DbContext ... -ContextDir Data -OutputDir Models
```

``` Console
dotnet ef dbcontext scaffold ... --context-dir Data --output-dir Models
```

## <a name="how-it-works"></a>Принцип работы

Реконструирование начинает работу со считывания схему базы данных. Он считывает сведения о таблицах, столбцы, ограничения и индексы.

Затем он использует сведения о схеме для создания модели EF Core. Таблицы используются для создания типов сущностей; столбцы используются для создания свойства; и внешние ключи используются для создания связей.

Наконец модель используется для создания кода. Соответствующие сущности типа классам, Fluent API и данные заметки сформированные для повторного создания одной и той же модели из вашего приложения.

## <a name="what-doesnt-work"></a>Что не работает

Не все о модели могут быть представлены с помощью схемы базы данных. Например, сведения о **иерархий наследования**, **принадлежащие типы**, и **таблицы разделение** не существуют в схеме базы данных. По этой причине эти конструкции будет никогда не быть реконструированию.

Кроме того **некоторые типы столбцов** могут не поддерживаться поставщика EF Core. Эти столбцы не будут включены в модель.

EF Core требуется иметь ключ каждого типа сущностей. Таблицы, не должны указать первичный ключ. **Таблицы без первичного ключа** являются в настоящее время не реконструирования.

Вы можете определить **маркеры параллелизма** в модель EF Core для запрещения два обновления той же сущности, в то же время. Некоторые базы данных имеют специальный тип для представления этого типа столбцов (например, rowversion в SQL Server) в этом случае можно проектировать эти данные; Тем не менее другие маркеры параллелизма будет не быть реконструированию.

## <a name="customizing-the-model"></a>Настройка модели

Код, сгенерированный EF Core является кодом. Вы можете изменить его. Он будет повторно, если вы снова обратного проектирования той же модели. Представляет сформированный код *один* модели, который может использоваться для доступа к базе данных, но определенно не является *только* модели, который может использоваться.

Настройте классы типов сущностей и класс DbContext в соответствии с потребностями. Например вы можете переименовать типы и свойства, вводят иерархии наследования или разбиение таблицы на несколько сущностей в. Вы также можно удалить из модели неуникальных индексов, неиспользуемые последовательностей и свойства навигации, необязательно скалярных свойств и имена ограничений.

Можно также добавить дополнительные конструкторы, методы, свойства, и т.д. с помощью другой разделяемый класс в отдельном файле. Этот подход работает даже в том случае, если вы намереваетесь Реконструировать модель еще раз.

## <a name="updating-the-model"></a>Обновление модели

После внесения изменений в базу данных, может потребоваться обновить модель EF Core для отражения этих изменений. В случае простого изменения базы данных может быть гораздо проще просто вручную внесите изменения в модель EF Core. Например переименование таблицы или столбца, удаление столбца или обновление столбца типа являются обычные изменения вносить в код.

Более значительные изменения, но не как легко создать вручную. Один общий рабочий процесс — обратный реконструирование модели из базы данных, снова используя `-Force` (PMC) или `--force` (CLI), чтобы перезаписать существующую модель, используя обновленный.

Другой часто запрашиваемых функцией является возможность обновить модель из базы данных, сохраняя настройки, такие как переименование, иерархии типов и т. д. Использовать проблема [#831](https://github.com/aspnet/EntityFrameworkCore/issues/831) для отслеживания хода выполнения этой функции.

> [!WARNING]
> Если вы обратного проектирования модели из базы данных будут потеряны все изменения, внесенные в файлы.
