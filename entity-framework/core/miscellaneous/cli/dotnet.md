---
title: EF Core Справочник по средствам (CLI) .NET — EF Core
author: bricelam
ms.author: bricelam
ms.date: 07/11/2019
uid: core/miscellaneous/cli/dotnet
ms.openlocfilehash: 05c5f89fc79556e72a7e629c147aa817fe7d1a6b
ms.sourcegitcommit: e90d6cfa3e96f10b8b5275430759a66a0c714ed1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/17/2019
ms.locfileid: "68286464"
---
# <a name="entity-framework-core-tools-reference---net-cli"></a>Справочник по — .NET CLI средствам Entity Framework Core

Средства интерфейса командной строки (CLI) для Entity Framework Core выполнения задач разработки во время разработки. Например, они создают [миграций](/aspnet/core/data/ef-mvc/migrations?view=aspnetcore-2.0#introduction-to-migrations), применить миграции и создать код для модели, основанные на существующей базы данных. Команды представляют собой расширение для кроссплатформенного [dotnet](/dotnet/core/tools) команду, которая входит в состав из [пакет SDK для .NET Core](https://www.microsoft.com/net/core). Эти средства работы с проектами .NET Core.

Если вы используете Visual Studio, мы рекомендуем [инструменты консоли диспетчера пакетов](powershell.md) вместо:
* Они автоматически взаимодействуют с текущего проекта, выбранного в **консоль диспетчера пакетов** без необходимости вручную переключить каталоги.
* Они автоматически открывают файлы, созданные с помощью команды после выполнения команды.

## <a name="installing-the-tools"></a>Установка инструментов

Процедура установки зависит от типа проекта и версии:

* EF Core 3.x
* ASP.NET Core версии 2.1 и более поздние версии
* EF Core 2.x
* EF Core 1.x

### <a name="ef-core-3x"></a>EF Core 3.x

* `dotnet ef` должен быть установлен как глобальные или локальные средства. Большинство разработчиков установит `dotnet ef` как средство глобального, выполнив следующую команду:

  ``` console
    $ dotnet tool install --global dotnet-ef --version 3.0.0-*
  ```

  Можно также использовать `dotnet ef` как локальный инструмент. Для использования в качестве локального средства, восстановить зависимости проекта, оно объявлено как зависимость средства с помощью [файла манифеста средства](https://github.com/dotnet/cli/issues/10288).

* Установка [.NET Core SDK 3.0](https://dotnet.microsoft.com/download/dotnet-core/3.0)). Пакет SDK должен быть установлен, даже если у вас есть последняя версия Visual Studio.

* Установите последнюю версию `Microsoft.EntityFrameworkCore.Design` пакета.

  ``` Console
  dotnet add package Microsoft.EntityFrameworkCore.Design
  ```

### <a name="aspnet-core-21"></a>ASP.NET Core 2.1 или более поздней

* Установка текущего [пакет SDK для .NET Core](https://www.microsoft.com/net/download/core). Это нужно сделать, даже если у вас установлена последняя версия Visual Studio 2017.

  Это все, что необходимо для ASP.NET Core 2.1 или более поздней, поскольку `Microsoft.EntityFrameworkCore.Design` пакет включен в [метапакет Microsoft.AspNetCore.App](/aspnet/core/fundamentals/metapackage-app).

### <a name="ef-core-2x-not-aspnet-core"></a>EF Core 2.x (не в ASP.NET Core)

`dotnet ef` Они включены в пакет SDK для .NET Core, но для включения команд необходимо установить `Microsoft.EntityFrameworkCore.Design` пакета.

* Установка текущего [пакет SDK для .NET Core](https://www.microsoft.com/net/download/core). Пакет SDK должен быть установлен, даже если у вас есть последняя версия Visual Studio.

* Установите последнюю стабильную `Microsoft.EntityFrameworkCore.Design` пакета.

  ``` Console
  dotnet add package Microsoft.EntityFrameworkCore.Design
  ```

### <a name="ef-core-1x"></a>EF Core 1.x

* Установка пакета SDK .NET Core версии 2.1.200. Более поздние версии не совместимы с помощью средств CLI для EF Core 1.0 и 1.1.

* Настройка приложения для использования 2.1.200 версию пакета SDK, изменив его [global.json](/dotnet/core/tools/global-json) файла. Этот файл обычно включаются в каталоге решения (по одному выше проекта).

* Измените файл проекта и добавьте `Microsoft.EntityFrameworkCore.Tools.DotNet` как `DotNetCliToolReference` элемента. Укажите последнюю версию 1.x, например: 1.1.6. См. в примере файла проекта в конце этого раздела.

* Установка последней версии 1.x `Microsoft.EntityFrameworkCore.Design` пакета, например:

  ```console
  dotnet add package Microsoft.EntityFrameworkCore.Design -v 1.1.6
  ```

  С помощью ссылки на пакеты оба добавлены файле проекта выглядит примерно следующим образом:

  ``` xml
  <Project Sdk="Microsoft.NET.Sdk">
    <PropertyGroup>
      <OutputType>Exe</OutputType>
      <TargetFramework>netcoreapp1.1</TargetFramework>
    </PropertyGroup>
    <ItemGroup>
      <PackageReference Include="Microsoft.EntityFrameworkCore.Design"
                        Version="1.1.6"
                         PrivateAssets="All" />
    </ItemGroup>
    <ItemGroup>
       <DotNetCliToolReference Include="Microsoft.EntityFrameworkCore.Tools.DotNet"
                              Version="1.1.6" />
    </ItemGroup>
  </Project>
  ```

  Ссылку на пакет с `PrivateAssets="All"` не предоставляется для проектов, которые ссылаются на этот проект. Это ограничение особенно полезна для пакетов, которые обычно используются только во время разработки.

### <a name="verify-installation"></a>Проверка установки

Выполните следующие команды, чтобы проверить, правильно установлены средства интерфейса командной строки EF Core:

  ``` Console
  dotnet restore
  dotnet ef
  ```

Результатом выполнения команды определяет версию средства в используйте:

```console

                     _/\__
               ---==/    \\
         ___  ___   |.    \|\
        | __|| __|  |  )   \\\
        | _| | _|   \_/ |  //|\\
        |___||_|       /   \\\/\\

Entity Framework Core .NET Command-line Tools 2.1.3-rtm-32065

<Usage documentation follows, not shown.>
```

## <a name="using-the-tools"></a>С помощью средств

Перед использованием средств, может потребоваться создать запускаемый проект, или установите среду.

### <a name="target-project-and-startup-project"></a>Целевой и запускаемый проект

См. команды *проекта* и *запускаемым проектом*.

* *Проекта* также известен как *целевой проект* так как это где команды добавления или удаления файлов. По умолчанию проект в текущем каталоге является целевого проекта. Можно указать другой проект в качестве целевого проекта с помощью <nobr> `--project` </nobr> параметр.

* *Запускаемым проектом* является тот, который построение и запуск средств. Средства должны выполнить код приложения во время разработки для получения сведений о проекте, например строку подключения базы данных и конфигурации модели. По умолчанию проект в текущем каталоге является запускаемым проектом. Можно указать другой проект запускаемым проектом с помощью <nobr> `--startup-project` </nobr> параметр.

Зачастую того же проекта запускаемого проекта и целевой проект. Типичный сценарий, где они находятся отдельные проекты — когда:

* В библиотеке классов .NET Core, EF Core контекст и классы сущностей.
* Консольное приложение .NET Core или веб-приложение ссылается на библиотеку классов.

Существует также возможность [поместите код миграции в библиотеку классов, отдельно от контекста EF Core](xref:core/managing-schemas/migrations/projects).

### <a name="other-target-frameworks"></a>Другие целевые платформы

Средства CLI работать с проектам .NET Core и .NET Framework. Приложения, которые имеют модель EF Core в библиотеку классов .NET Standard может отсутствовать, .NET Core или .NET Framework проекта. Например это верно для приложений Xamarin и универсальной платформы Windows. В таком случае можно создать проект консольного приложения .NET Core, единственным назначением которого является в качестве запускаемого проекта для средств. Проект может быть пустым проектом с не содержащим реального кода &mdash; этот компонент необходим только для предоставления целевой объект для выполнения средства.

Почему является пустым проектом требуется? Как упоминалось ранее, средства нужно выполнять код приложения во время разработки. Для этого им необходимо использовать среду выполнения .NET Core. Когда модель EF Core находится в проекте, ориентированном на .NET Core или .NET Framework, средства EF Core позаимствовать среды выполнения из проекта. Они не могут делать, если модель EF Core в библиотеку классов .NET Standard. .NET Standard не фактическую реализацию .NET; это спецификация набора API-интерфейсов, реализации .NET должны поддерживать. Поэтому .NET Standard недостаточно для инструментов EF Core для выполнения кода приложения. Фиктивный проект, созданный для использования в качестве запускаемого проекта предоставляет конкретную целевую платформу, в которой средства можно загружать библиотеки классов .NET Standard.

### <a name="aspnet-core-environment"></a>Среда ASP.NET Core

Чтобы указать среду для проектов ASP.NET Core, задайте **ASPNETCORE_ENVIRONMENT** переменной среды перед запуском команды.

## <a name="common-options"></a>Общие параметры

|                   | Параметр                            | Описание                                                                                                                                                                                                                                                   |
|:------------------|:----------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                   | `--json`                          | Показать выходные данные JSON.                                                                                                                                                                                                                                             |
| <nobr>`-c`</nobr> | `--context <DBCONTEXT>`           | Класс `DbContext` для использования. Имя класса, только из цифр или полное с пространствами имен.  Если этот параметр опущен, найти класс контекста EF Core. Если имеется несколько классов контекста, этот параметр является обязательным.                                            |
| `-p`              | `--project <PROJECT>`             | Относительный путь к папке проекта целевого проекта.  Значение по умолчанию является текущая папка.                                                                                                                                                              |
| `-s`              | `--startup-project <PROJECT>`     | Относительный путь к папке проекта, запускаемого проекта. Значение по умолчанию является текущая папка.                                                                                                                                                              |
|                   | `--framework <FRAMEWORK>`         | [Моникера целевой платформы](/dotnet/standard/frameworks#supported-target-framework-versions) для [требуемой версии .NET framework](/dotnet/standard/frameworks).  Используется, если в файле проекта указываются нескольких целевых платформ, и вы хотите выбрать один из них. |
|                   | `--configuration <CONFIGURATION>` | Конфигурацию сборки, например: `Debug` или `Release`.                                                                                                                                                                                                   |
|                   | `--runtime <IDENTIFIER>`          | Идентификатор целевой среды выполнения для восстановления пакетов. Список идентификаторов сред выполнения (RID) см. в [каталоге RID](/dotnet/core/rid-catalog).                                                                                                      |
| `-h`              | `--help`                          | Показать справочные сведения.                                                                                                                                                                                                                                        |
| `-v`              | `--verbose`                       | Показать подробные выходные данные.                                                                                                                                                                                                                                          |
|                   | `--no-color`                      | Не необходимо выделить цветом выходные данные.                                                                                                                                                                                                                                        |
|                   | `--prefix-output`                 | Префикс выходных данных с уровнем.                                                                                                                                                                                                                                     |

## <a name="dotnet-ef-database-drop"></a>Удаление базы данных ef DotNet

Удаляет базу данных.

Параметры:

|                   | Параметр                   | Описание                                              |
|:------------------|:-------------------------|:---------------------------------------------------------|
| <nobr>`-f`</nobr> | <nobr>`--force`</nobr>   | Не подтверждено.                                           |
|                   | <nobr>`--dry-run`</nobr> | Показать базу данных, которая будет удалена, но не удаляйте ее. |

## <a name="dotnet-ef-database-update"></a>Обновление базы данных ef DotNet

Обновляет базу данных, последнюю миграцию или указанного миграции.

Аргументы.

| Аргумент      | Описание                                                                                                                                                                                                                                                     |
|:--------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `<MIGRATION>` | Целевой объект миграции. Миграция может быть идентифицирован по имени или по идентификатору. Число 0 является особым случаем, это значит, что *перед первой миграции* и вызывает всех операций переноса для отмены изменений. Если перенос не указан, команда по умолчанию к последней миграции. |

Следующие примеры обновления базы данных для указанного миграции. Первый использует имя миграции, а второй использует идентификатор миграции:

```console
dotnet ef database update InitialCreate
dotnet ef database update 20180904195021_InitialCreate
```

## <a name="dotnet-ef-dbcontext-info"></a>сведения о dbcontext ef DotNet

Получает сведения о `DbContext` типа.

## <a name="dotnet-ef-dbcontext-list"></a>DotNet ef dbcontext списка

Выводит список доступных `DbContext` типов.

## <a name="dotnet-ef-dbcontext-scaffold"></a>DotNet ef dbcontext каркаса

Создает код для `DbContext` и типы сущностей для базы данных. Чтобы эту команду, чтобы создать тип сущности в таблице базы данных должен иметь первичный ключ.

Аргументы.

| Аргумент       | Описание                                                                                                                                                                                                             |
|:---------------|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `<CONNECTION>` | Строка подключения к базе данных. Для проектов ASP.NET Core 2.x, значение может быть *имя =\<имя строки подключения >* . В этом случае имя берется из источников конфигурации, которые были настроены для проекта. |
| `<PROVIDER>`   | Используемый поставщик. Обычно это имя пакета NuGet, например: `Microsoft.EntityFrameworkCore.SqlServer`.                                                                                           |

Параметры:

|                 | Параметр                                   | Описание                                                                                                                                                                    |
|:----------------|:-----------------------------------------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <nobr>-d</nobr> | `--data-annotations`                     | Атрибуты можно используйте для настройки модели (где это возможно). Если этот параметр опущен, используется только текучего API.                                                                |
| `-c`            | `--context <NAME>`                       | Имя `DbContext` класса, необходимо создать.                                                                                                                                 |
|                 | `--context-dir <PATH>`                   | Каталог для размещения `DbContext` файл класса. Пути задаются относительно каталога проекта. Пространства имен являются производными от ее имени.                                 |
| `-f`            | `--force`                                | Перезаписывайте существующие файлы.                                                                                                                                                      |
| `-o`            | `--output-dir <PATH>`                    | Чтобы поместить файлы классов сущностей в каталог. Пути задаются относительно каталога проекта.                                                                                       |
|                 | <nobr>`--schema <SCHEMA_NAME>...`</nobr> | Схемы таблиц для создания типов сущности для. Чтобы указать несколько схем, повторите `--schema` для каждого из них. Если этот параметр указан, включаются все схемы.          |
| `-t`            | `--table <TABLE_NAME>`...                | Для создания типов сущности для таблиц. Чтобы указать несколько таблиц, повторите `-t` или `--table` для каждого из них. Если этот параметр указан, включаются все таблицы.                |
|                 | `--use-database-names`                   | Используйте имена таблиц и столбцов, так же, как в базе данных. Если этот параметр задан, имена баз данных меняется на более точно соответствовать соглашениям C# имя стиля. |

В следующем примере, формирует шаблоны все схемы и таблицы и помещает новые файлы в *моделей* папки.

```console
dotnet ef dbcontext scaffold "Server=(localdb)\mssqllocaldb;Database=Blogging;Trusted_Connection=True;" Microsoft.EntityFrameworkCore.SqlServer -o Models
```

В следующем примере формирует шаблоны только указанных таблиц и создает контекст в отдельную папку с указанным именем:

```console
dotnet ef dbcontext scaffold "Server=(localdb)\mssqllocaldb;Database=Blogging;Trusted_Connection=True;" Microsoft.EntityFrameworkCore.SqlServer -o Models -t Blog -t Post --context-dir Context -c BlogContext
```

## <a name="dotnet-ef-migrations-add"></a>Добавление DotNet ef migrations

Добавление новой миграции.

Аргументы.

| Аргумент | Описание                |
|:---------|:---------------------------|
| `<NAME>` | Имя миграции. |

Параметры:

|                   | Параметр                             | Описание                                                                                                      |
|:------------------|:-----------------------------------|:-----------------------------------------------------------------------------------------------------------------|
| <nobr>`-o`</nobr> | <nobr>`--output-dir <PATH>`</nobr> | Каталог (и sub-namespace) для использования. Пути задаются относительно каталога проекта. По умолчанию используется «Миграция». |

## <a name="dotnet-ef-migrations-list"></a>DotNet ef migrations списка

Список доступных миграций.

## <a name="dotnet-ef-migrations-remove"></a>удалить DotNet ef migrations

Удаляет последнюю миграцию (выполняется откат изменений кода, которые были выполнены для миграции).

Параметры:

|                   | Параметр    | Описание                                                                     |
|:------------------|:----------|:--------------------------------------------------------------------------------|
| <nobr>`-f`</nobr> | `--force` | Миграции отменить (откатить изменения, которые были применены к базе данных). |

## <a name="dotnet-ef-migrations-script"></a>DotNet ef migrations сценария

Формирует скрипт SQL из миграции.

Аргументы.

| Аргумент | Описание                                                                                                                                                   |
|:---------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `<FROM>` | Начала миграции. Миграция может быть идентифицирован по имени или по идентификатору. Число 0 является особым случаем, это значит, что *перед первой миграции*. По умолчанию равно 0. |
| `<TO>`   | Окончания миграции. По умолчанию к последней миграции.                                                                                                         |

Параметры:

|                   | Параметр            | Описание                                                        |
|:------------------|:------------------|:-------------------------------------------------------------------|
| <nobr>`-o`</nobr> | `--output <FILE>` | Файл, чтобы написать сценарий для.                                   |
| `-i`              | `--idempotent`    | Создайте скрипт, который может использоваться в любой базе данных с любой миграции. |

В следующем примере создается скрипт для миграции это InitialCreate:

```console
dotnet ef migrations script 0 InitialCreate
```

В следующем примере создается скрипт для всех операций миграции после миграции это InitialCreate.

```console
dotnet ef migrations script 20180904195021_InitialCreate
```

## <a name="additional-resources"></a>Дополнительные ресурсы

* [Миграции](xref:core/managing-schemas/migrations/index)
* [Реконструирование](xref:core/managing-schemas/scaffolding)
