---
title: Заполнение данными — EF Core
author: AndriySvyryd
ms.author: ansvyryd
ms.date: 11/02/2018
ms.assetid: 3154BF3C-1749-4C60-8D51-AE86773AA116
uid: core/modeling/data-seeding
ms.openlocfilehash: 1c450b142573368d043430f55a3144b6696a8691
ms.sourcegitcommit: b4a5ed177b86bf7f81602106dab6b4acc18dfc18
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/15/2019
ms.locfileid: "54316638"
---
# <a name="data-seeding"></a>Присвоение начальных значений данных

Заполнение данными — это процесс заполнения базы данных с исходного набора данных.

Это можно сделать в EF Core несколькими способами:
* Начальное значение данных модели
* Настройка миграции вручную
* Логику пользовательского инициализации

## <a name="model-seed-data"></a>Начальное значение данных модели

> [!NOTE]
> Это новая возможность в EF Core 2.1.

В отличие от в EF6 в EF Core, заполнение данных можно связать с типом сущности как часть конфигурации модели. Затем EF Core [миграций](xref:core/managing-schemas/migrations/index) может автоматически вычислить, что вставить, обновить или удалить операции необходимо применить при обновлении базы данных до новой версии модели.

> [!NOTE]
> Миграция рассматривает изменения модели только в том случае, при определении, какая операция должна выполняться для получения начального значения данных в нужном состоянии. Таким образом любые изменения данных, выполнены не миграции могут быть потеряны или вызывать ошибку.

Например, это настроить начальные данные для `Blog` в `OnModelCreating`:

[!code-csharp[BlogSeed](../../../samples/core/Modeling/DataSeeding/DataSeedingContext.cs?name=BlogSeed)]

Добавление сущностей, которые имеют отношение значения внешнего ключа необходимо указать:

[!code-csharp[PostSeed](../../../samples/core/Modeling/DataSeeding/DataSeedingContext.cs?name=PostSeed)]

Если тип сущности имеет какие-либо свойства в состоянии тени анонимный класс можно использовать для предоставления значений:

[!code-csharp[AnonymousPostSeed](../../../samples/core/Modeling/DataSeeding/DataSeedingContext.cs?name=AnonymousPostSeed)]

Принадлежащих сущностей, типы могут заполняться данными аналогичным образом:

[!code-csharp[OwnedTypeSeed](../../../samples/core/Modeling/DataSeeding/DataSeedingContext.cs?name=OwnedTypeSeed)]

См. в разделе [полный пример проекта](https://github.com/aspnet/EntityFramework.Docs/tree/master/samples/core/Modeling/DataSeeding) дополнительный контекст.

После добавления данных в модель [миграций](xref:core/managing-schemas/migrations/index) следует использовать для применения изменений.

> [!TIP]
> Если вам нужно применить миграции как часть автоматизированного развертывания вы можете [создать сценарий SQL](xref:core/managing-schemas/migrations/index#generate-sql-scripts) , можно просмотреть перед выполнением.

Кроме того, можно использовать `context.Database.EnsureCreated()` для создания новой базы данных, содержащей начальные данные, например для тестовой базы данных или при использовании поставщика в памяти или любой базы данных не отношения. Обратите внимание, что если база данных уже существует, `EnsureCreated()` не обновит данные схемы, ни начальное значение в базе данных. Для реляционных баз данных не следует вызывать `EnsureCreated()` Если вы планируете использовать миграций.

### <a name="limitations-of-model-seed-data"></a>Ограничения модели начальные данные

Начальное значение данных этого типа осуществляется с помощью миграций и скрипт для обновления данных, который уже находится в базе данных необходимо создать без подключения к базе данных. Это накладывает некоторые ограничения:
* Значение первичного ключа необходимо указать, даже если он обычно формируется по базе данных. Он будет использоваться для обнаружения изменений данных между миграций.
* Ранее заполненные данные будут удалены, если первичный ключ изменяется каким-либо образом.

Поэтому эта функция наиболее полезна для статических данных, который имеет предположительно неизменной вне миграции и не зависит от любых других в базе данных, например, ПОЧТОВЫЕ индексы.

Если ваш сценарий включает следующие рекомендуется использовать логику пользовательской инициализации, описанных в предыдущем разделе:
* Временные данные для тестирования
* Данные, зависящие от состояния базы данных
* Данные, которые требуются значения ключа, чтобы создать в базе данных, включая сущности, используемый для идентификации альтернативные ключи
* Данных, который требует преобразования (которое не обрабатывается [значение преобразования](xref:core/modeling/value-conversions)), например некоторые хэширование паролей
* Данные, требующие вызовы к внешнему интерфейсу API, например, Создание ролей и пользователей удостоверения ASP.NET Core

## <a name="manual-migration-customization"></a>Настройка миграции вручную

При добавлении миграции изменения в данных, указанных с помощью `HasData` преобразуются в вызовы `InsertData()`, `UpdateData()`, и `DeleteData()`. Один из способов обойти некоторые ограничения `HasData` можно вручную добавить эти вызовы или [пользовательских операций](xref:core/managing-schemas/migrations/operations) миграции вместо этого.

[!code-csharp[CustomInsert](../../../samples/core/Modeling/DataSeeding/Migrations/20181102235626_Initial.cs?name=CustomInsert)]

## <a name="custom-initialization-logic"></a>Логику пользовательского инициализации

Простой и мощный способ выполнить заполнение данными является использование [ `DbContext.SaveChanges()` ](xref:core/saving/index) до основного приложения логики начала выполнения.

[!code-csharp[Main](../../../samples/core/Modeling/DataSeeding/Program.cs?name=CustomSeeding)]

> [!WARNING]
> Код заполнения не должны быть частью выполнения обычное приложение, как это может вызвать проблемы параллелизма, если несколько экземпляров, работают, а также потребует выполнения приложения, у которых есть разрешение на изменение схемы базы данных.

В зависимости от ограничений развертывания код инициализации можно выполнить разными способами:
* Локального запуска приложения инициализации
* Развертывание приложения инициализации с основного приложения, вызов процедуры инициализации и отключении или удалении его инициализации.

Это обычно может быть автоматизирована с помощью [профилей публикации](https://docs.microsoft.com/en-us/aspnet/core/host-and-deploy/visual-studio-publish-profiles).
