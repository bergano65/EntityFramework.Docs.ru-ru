---
title: Сформированные значения — EF Core
description: Настройка создания значений для свойств при использовании Entity Framework Core
author: AndriySvyryd
ms.author: ansvyryd
ms.date: 11/06/2019
uid: core/modeling/generated-properties
ms.openlocfilehash: 9c616e157ff1bdb9700f436a7ae2788330fe5d45
ms.sourcegitcommit: cc0ff36e46e9ed3527638f7208000e8521faef2e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78413903"
---
# <a name="generated-values"></a>Созданные значения

## <a name="value-generation-patterns"></a>Шаблоны создания значений

Существует три шаблона для генерируемых значений, которые могут использоваться для свойств.

* Без генерации значения
* Значение, генерируемое при добавлении
* Значение, генерируемое при добавлении или обновлении

### <a name="no-value-generation"></a>Без генерации значения

Без генерации значения означает, что необходимо всегда указывать допустимое значение, которое будет сохранено в базе данных. Допустимое значение должно быть присвоено новым сущностям до того, как они будут добавлены в контекст.

### <a name="value-generated-on-add"></a>Значение, генерируемое при добавлении

Значение, генерируемое при добавлении, означает, что значение будет генерироваться для новых сущностей.

В зависимости от используемого поставщика базы данных, значение может генерироваться как на стороне клиента с помощью EF, так и на стороне базы данных. Если значение генерируется средствами базы данных, EF может присвоить временное значение при добавлении сущности в контекст. Это временное значение затем будет заменено созданным значением базы данных во время `SaveChanges()`.

Если в контекст добавляется сущность, свойству которой присвоено значение, EF пытается вставить это значение, а не генерировать новое. Свойство считается назначенным, если ему не присвоено значение CLR по умолчанию (`null` для `string`, `0` для `int`, `Guid.Empty` для `Guid`и т. д.). Дополнительные сведения см. в разделе [явные значения для созданных свойств](../saving/explicit-values-generated-properties.md).

> [!WARNING]
> Способ генерации значений при добавлении сущностей будет зависеть от используемого поставщика базы данных. Он может устанавливать автоматическую генерацию значений для некоторых типов свойств, тогда как другие могут требовать явного указания способа генерации значений.
>
> Например, при использовании SQL Server значения будут автоматически создаваться для `GUID` свойств (с использованием алгоритма последовательного GUID SQL Server). Однако если указать, что при добавлении создается свойство `DateTime`, необходимо настроить способ создания значений. Один из способов сделать это — настроить значение по умолчанию `GETDATE()`, см. раздел [значения по умолчанию](relational/default-values.md).

### <a name="value-generated-on-add-or-update"></a>Значение, генерируемое при добавлении или обновлении

Значение, генерируемое при добавлении или обновлении, означает, что новые значения будут генерироваться каждый раз, когда происходит сохранение записи (вставка или обновление).

Как и `value generated on add`, если указать значение для свойства только что добавленного экземпляра сущности, это значение будет вставлено вместо создаваемого значения. Также можно задать явное значение при обновлении Дополнительные сведения см. в разделе [явные значения для созданных свойств](../saving/explicit-values-generated-properties.md).

> [!WARNING]
> То, как значение создается для добавленных и обновленных сущностей, зависит от используемого поставщика базы данных. Поставщики баз данных могут устанавливать атоматическую генерацию значений для некоторых типов свойств, тогда как другие требуют явного указания способа генерации значений.
>
> Например, при использовании SQL Server `byte[]` свойства, которые устанавливаются, как созданные при добавлении или обновлении и помеченные как маркеры параллелизма, будут настроены с типом данных `rowversion`, чтобы в базе данных создавались значения. Однако если указать, что при добавлении или обновлении будет создано свойство `DateTime`, необходимо настроить способ создания значений. Одним из способов сделать это является настройка значения по умолчанию `GETDATE()` (см. [значения по умолчанию](relational/default-values.md)) для создания значений для новых строк. Затем для генерации значений при обновлении можно использовать триггеры базы данных (например, как триггер в примере ниже).
>
> [!code-sql[Main](../../../samples/core/Modeling/FluentAPI/ValueGeneratedOnAddOrUpdate.sql)]

## <a name="value-generated-on-add"></a>Значение, генерируемое при добавлении

В соответствии с соглашением Несоставные первичные ключи типа Short, int, long или GUID настраиваются так, чтобы иметь значения, созданные для вставленных сущностей, если значение не предоставлено приложением. Поставщик базы данных обычно выполняет необходимую настройку. Например, числовой первичный ключ в SQL Server автоматически настраивается как столбец ИДЕНТИФИКАТОРов.

Можно настроить любое свойство так, чтобы его значение создавалось для вставленных сущностей следующим образом:

### <a name="data-annotations"></a>[Заметки к данным](#tab/data-annotations)

[!code-csharp[Main](../../../samples/core/Modeling/DataAnnotations/ValueGeneratedOnAdd.cs?name=ValueGeneratedOnAdd&highlight=5)]

### <a name="fluent-api"></a>[API Fluent](#tab/fluent-api)

[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/ValueGeneratedOnAdd.cs?name=ValueGeneratedOnAdd&highlight=5)]

***

> [!WARNING]
> Здесь просто сообщается EF, что значения генерируются для добавляемых сущностей. Это не гарантирует, что EF будет использовать реальный механизм для генерации значений. Дополнительные сведения см. [в разделе значение, созданное при добавлении](#value-generated-on-add) раздела.

### <a name="default-values"></a>Значения по умолчанию

В реляционных базах данных столбец можно настроить со значением по умолчанию. Если строка вставляется без значения для этого столбца, будет использоваться значение по умолчанию.

Можно настроить значение по умолчанию для свойства.

[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/DefaultValue.cs?name=DefaultValue&highlight=5)]

Можно также указать фрагмент SQL, используемый для вычисления значения по умолчанию:

[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/DefaultValueSql.cs?name=DefaultValueSql&highlight=5)]

При указании значения по умолчанию свойство будет неявно настроено как значение, созданное при добавлении.

## <a name="value-generated-on-add-or-update"></a>Значение, генерируемое при добавлении или обновлении

### <a name="data-annotations"></a>[Заметки к данным](#tab/data-annotations)

[!code-csharp[Main](../../../samples/core/Modeling/DataAnnotations/ValueGeneratedOnAddOrUpdate.cs?name=ValueGeneratedOnAddOrUpdate&highlight=5)]

### <a name="fluent-api"></a>[API Fluent](#tab/fluent-api)

[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/ValueGeneratedOnAddOrUpdate.cs?name=ValueGeneratedOnAddOrUpdate&highlight=5)]

***

> [!WARNING]
> Здесь просто сообщается EF, что значения генерируются для добавляемых или обновляемых сущностей. Это не гарантирует, что EF будет использовать реальный механизм для генерации значений. Дополнительные сведения см. [в разделе Добавление или обновление](#value-generated-on-add-or-update) раздела.

### <a name="computed-columns"></a>Вычисляемые столбцы

В некоторых реляционных базах данных столбец можно настроить так, чтобы его значение было вычислено в базе данных, как правило, с выражением, ссылающимся на другие столбцы:

[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/ComputedColumn.cs?name=ComputedColumn&highlight=5)]

> [!NOTE]
> В некоторых случаях значение столбца вычисляются при каждом выборке (иногда называемых *виртуальными* столбцами), а в других — при каждом обновлении строки и при хранении (иногда называемых *хранимыми* или *материализованными* столбцами). Это зависит от поставщиков баз данных.

## <a name="no-value-generation"></a>Без генерации значения

Отключение создания значения для свойства обычно требуется, если соглашение настраивает его для создания значения. Например, если имеется первичный ключ типа int, он будет неявно настроен в качестве значения, созданного при добавлении; Это можно отключить следующими средствами:

### <a name="data-annotations"></a>[Заметки к данным](#tab/data-annotations)

[!code-csharp[Main](../../../samples/core/Modeling/DataAnnotations/ValueGeneratedNever.cs?name=ValueGeneratedNever&highlight=3)]

### <a name="fluent-api"></a>[API Fluent](#tab/fluent-api)

[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/ValueGeneratedNever.cs?name=ValueGeneratedNever&highlight=5)]

***
