---
title: Сформированные значения — EF Core
author: rowanmiller
ms.date: 10/27/2016
ms.assetid: eb082011-11a1-41b4-a108-15daafa03e80
uid: core/modeling/generated-properties
ms.openlocfilehash: 6b38fd2e540ec29674f1116e7c204052d06ca1bc
ms.sourcegitcommit: ec196918691f50cd0b21693515b0549f06d9f39c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/23/2019
ms.locfileid: "71197424"
---
# <a name="generated-values"></a>Генерируемые значения

## <a name="value-generation-patterns"></a>Шаблоны для генерируемых значений

Существует три шаблона для генерируемых значений, которые могут использоваться для свойств.
* Без генерации значения
* Значение, генерируемое при добавлении
* Значение, генерируемое при добавлении или обновлении

### <a name="no-value-generation"></a>Без генерации значения

Без генерации значения означает, что необходимо всегда указывать допустимое значение, которое будет сохранено в базе данных. Допустимое значение должно быть присвоено новым сущностям до того, как они будут добавлены в контекст.

### <a name="value-generated-on-add"></a>Значение, генерируемое при добавлении

Значение, генерируемое при добавлении, означает, что значение будет генерироваться для новых сущностей.

В зависимости от используемого поставщика базы данных, значение может генерироваться как на стороне клиента с помощью EF, так и на стороне базы данных. Если значение генерируется средствами базы данных, EF может присвоить временное значение при добавлении сущности в контекст. Затем временное значение может быть заменено на значение, сгенерированное базой данных, во время вызова `SaveChanges()`.

Если в контекст добавляется сущность, свойству которой присвоено значение, EF пытается вставить это значение, а не генерировать новое. Считается, что свойству присвоено значение, если ему не установлено значение по умолчанию в среде CLR (`null` для `string`, `0` для `int`, `Guid.Empty` для `Guid`и т. д.). Дополнительные сведения см. в статье [Установка явных значений для создаваемых свойств](../saving/explicit-values-generated-properties.md).

> [!WARNING]  
> Способ генерации значений при добавлении сущностей будет зависеть от используемого поставщика базы данных. Он может устанавливать автоматическую генерацию значений для некоторых типов свойств, тогда как другие могут требовать явного указания способа генерации значений.
>
> Например, при использовании SQL Server значения будут автоматически генерироваться для `GUID` свойства (с помощью алгоритма последовательной генерации GUID в SQL Server). Однако, если для свойства `DateTime` задать генерацию значений при добавлении, то необходимо указать способ генерации этих значений. Один из вариантов сделать это — настроить значение по умолчанию для `GETDATE()`, См. статью [значения по умолчанию](relational/default-values.md).

### <a name="value-generated-on-add-or-update"></a>Значение, генерируемое при добавлении или обновлении

Значение, генерируемое при добавлении или обновлении, означает, что новые значения будут генерироваться каждый раз, когда происходит сохранение записи (вставка или обновление).

Как и `value generated on add`, в случае со значением, генерируемым при добавлении, если свойству нового экземпляра сущности присвоить какое-то значение, будет вставлено именно это значение, а не генерируемое. Также можно задать явное значение при обновлении Дополнительные сведения см. в статье [Установка явных значений для создаваемых свойств](../saving/explicit-values-generated-properties.md).

> [!WARNING]
> То, как значение создается для добавленных и обновленных сущностей, зависит от используемого поставщика базы данных. Поставщики баз данных могут устанавливать атоматическую генерацию значений для некоторых типов свойств, тогда как другие требуют явного указания способа генерации значений.
> 
> Например, при использовании SQL Server свойства `byte[]` , которым установлена генерация значений при добавлении и обновлении и которые отмечены как токены параллелизма, будут иметь тип данных `rowversion` , так что значения будут генерироваться в базе данных. Но если указать, что значение свойства `DateTime` генерируется при добавлении или обновлении, то необходимо указать способ генерации значения. Один из вариантов сделать это — настроить значение по умолчанию для `GETDATE()`(см. статью [Значения по умолчанию](relational/default-values.md)), чтобы генерировать значения для новых строк. Затем для генерации значений при обновлении можно использовать триггеры базы данных (например, как триггер в примере ниже).
> 
> [!code-sql[Main](../../../samples/core/Modeling/FluentAPI/ValueGeneratedOnAddOrUpdate.sql)]

## <a name="conventions"></a>Соглашения

Обычно для несоставных первичных ключей типов short, int, long или Guid значения генерируются при добавлении. Для всех остальных свойств значения не будут генерироваться.

## <a name="data-annotations"></a>Заметки к данным

### <a name="no-value-generation-data-annotations"></a>Без генерации значения (заметки к данным)

[!code-csharp[Main](../../../samples/core/Modeling/DataAnnotations/ValueGeneratedNever.cs#Sample)]

### <a name="value-generated-on-add-data-annotations"></a>Значение, генерируемое при добавлении (заметки к данным)

[!code-csharp[Main](../../../samples/core/Modeling/DataAnnotations/ValueGeneratedOnAdd.cs#Sample)]

> [!WARNING]  
> Здесь просто сообщается EF, что значения генерируются для добавляемых сущностей. Это не гарантирует, что EF будет использовать реальный механизм для генерации значений. См. в разделе [Значение, генерируемое при добавлении](#value-generated-on-add).

### <a name="value-generated-on-add-or-update-data-annotations"></a>Значение, генерируемое при добавлении или обновлении (заметки к данным)

[!code-csharp[Main](../../../samples/core/Modeling/DataAnnotations/ValueGeneratedOnAddOrUpdate.cs#Sample)]

> [!WARNING]  
> Здесь просто сообщается EF, что значения генерируются для добавляемых или обновляемых сущностей. Это не гарантирует, что EF будет использовать реальный механизм для генерации значений. Более подробные сведения см. в разделе [Значение, генерируемое при добавлении или обновлении](#value-generated-on-add-or-update) .

## <a name="fluent-api"></a>Текучий API

Текучий API можно использовать для изменения шаблона генерации значения для заданного свойства.

### <a name="no-value-generation-fluent-api"></a>Без генерации значения (текучий API)

[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/ValueGeneratedNever.cs#Sample)]

### <a name="value-generated-on-add-fluent-api"></a>Значение, генерируемое при добавлении (текучий API)

[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/ValueGeneratedOnAdd.cs#Sample)]

> [!WARNING]  
> `ValueGeneratedOnAdd()` просто сообщает EF, что значения генерируются для добавляемых сущностей. Это не гарантирует, что EF будет использовать реальный механизм для генерации значений.  См. в разделе [Значение, генерируемое при добавлении](#value-generated-on-add).

### <a name="value-generated-on-add-or-update-fluent-api"></a>Значение, генерируемое при добавлении или обновлении (текучий API)

[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/ValueGeneratedOnAddOrUpdate.cs#Sample)]

> [!WARNING]  
> Здесь просто сообщается EF, что значения генерируются для добавляемых или обновляемых сущностей. Это не гарантирует, что EF будет использовать реальный механизм для генерации значений. Более подробные сведения см. в разделе [Значение, генерируемое при добавлении или обновлении](#value-generated-on-add-or-update) .
