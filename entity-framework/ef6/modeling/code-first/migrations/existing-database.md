---
title: Code First Migrations с существующей базой данных — EF6
author: divega
ms.date: 10/23/2016
ms.assetid: f0cc4f93-67dd-4664-9753-0a9f913814db
ms.openlocfilehash: eb7948eafb1322cabcf69b47bd5411f762fe8498
ms.sourcegitcommit: 708b18520321c587b2046ad2ea9fa7c48aeebfe5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/09/2019
ms.locfileid: "72182585"
---
# <a name="code-first-migrations-with-an-existing-database"></a><span data-ttu-id="a339d-102">Code First Migrations с существующей базой данных</span><span class="sxs-lookup"><span data-stu-id="a339d-102">Code First Migrations with an existing database</span></span>
> [!NOTE]
> <span data-ttu-id="a339d-103">**EF 4.3 только в сторону** — функции, API и т. д., обсуждаемые на этой странице, появились в Entity Framework 4,1.</span><span class="sxs-lookup"><span data-stu-id="a339d-103">**EF4.3 Onwards Only** - The features, APIs, etc. discussed in this page were introduced in Entity Framework 4.1.</span></span> <span data-ttu-id="a339d-104">При использовании более ранней версии могут быть неприменимы некоторые или все сведения.</span><span class="sxs-lookup"><span data-stu-id="a339d-104">If you are using an earlier version, some or all of the information does not apply.</span></span>

<span data-ttu-id="a339d-105">В этой статье рассматривается использование Code First Migrations с существующей базой данных, которая не была создана с помощью Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="a339d-105">This article covers using Code First Migrations with an existing database, one that wasn’t created by Entity Framework.</span></span>

> [!NOTE]
> <span data-ttu-id="a339d-106">В этой статье предполагается, что вы умеете использовать Code First Migrations в основных сценариях.</span><span class="sxs-lookup"><span data-stu-id="a339d-106">This article assumes you know how to use Code First Migrations in basic scenarios.</span></span> <span data-ttu-id="a339d-107">В противном случае необходимо прочитать [Code First migrations](~/ef6/modeling/code-first/migrations/index.md) , прежде чем продолжить.</span><span class="sxs-lookup"><span data-stu-id="a339d-107">If you don’t, then you’ll need to read [Code First Migrations](~/ef6/modeling/code-first/migrations/index.md) before continuing.</span></span>

## <a name="screencasts"></a><span data-ttu-id="a339d-108">Демонстрационные ролики</span><span class="sxs-lookup"><span data-stu-id="a339d-108">Screencasts</span></span>

<span data-ttu-id="a339d-109">Если бы вы хотели Смотреть ролик, чем читать эту статью, в следующих двух видеороликах будет рассмотрено то же содержимое, что и в этой статье.</span><span class="sxs-lookup"><span data-stu-id="a339d-109">If you'd rather watch a screencast than read this article, the following two videos cover the same content as this article.</span></span>

### <a name="video-one-migrations---under-the-hood"></a><span data-ttu-id="a339d-110">Видеоматериалы: «миграция — внутри себя»</span><span class="sxs-lookup"><span data-stu-id="a339d-110">Video One: "Migrations - Under the Hood"</span></span>

<span data-ttu-id="a339d-111">В [этой презентации](https://channel9.msdn.com/blogs/ef/migrations-under-the-hood) рассматривается, как миграция отслеживает и использует сведения о модели для обнаружения изменений модели.</span><span class="sxs-lookup"><span data-stu-id="a339d-111">[This screencast](https://channel9.msdn.com/blogs/ef/migrations-under-the-hood) covers how migrations tracks and uses information about the model to detect model changes.</span></span>

### <a name="video-two-migrations---existing-databases"></a><span data-ttu-id="a339d-112">Видео 2: "миграция — существующие базы данных"</span><span class="sxs-lookup"><span data-stu-id="a339d-112">Video Two: "Migrations - Existing Databases"</span></span>

<span data-ttu-id="a339d-113">С помощью [этой презентации](https://channel9.msdn.com/blogs/ef/migrations-existing-databases) вы узнаете о том, как включить и использовать миграцию с существующей базой данных, основываясь на концепциях предыдущего видео.</span><span class="sxs-lookup"><span data-stu-id="a339d-113">Building on the concepts from the previous video, [this screencast](https://channel9.msdn.com/blogs/ef/migrations-existing-databases) covers how to enable and use migrations with an existing database.</span></span>

## <a name="step-1-create-a-model"></a><span data-ttu-id="a339d-114">Шаг 1. Создание модели</span><span class="sxs-lookup"><span data-stu-id="a339d-114">Step 1: Create a model</span></span>

<span data-ttu-id="a339d-115">Первым шагом будет создание модели Code First, предназначенной для существующей базы данных.</span><span class="sxs-lookup"><span data-stu-id="a339d-115">Your first step will be to create a Code First model that targets your existing database.</span></span> <span data-ttu-id="a339d-116">В разделе [Code First к существующей базе данных](~/ef6/modeling/code-first/workflows/existing-database.md) содержится подробное руководство по выполнению этой задачи.</span><span class="sxs-lookup"><span data-stu-id="a339d-116">The [Code First to an Existing Database](~/ef6/modeling/code-first/workflows/existing-database.md) topic provides detailed guidance on how to do this.</span></span>

>[!NOTE]
> <span data-ttu-id="a339d-117">Прежде чем вносить изменения в модель, требующую внесения изменений в схему базы данных, важно выполнить остальные действия, описанные в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="a339d-117">It is important to follow the rest of the steps in this topic before making any changes to your model that would require changes to the database schema.</span></span> <span data-ttu-id="a339d-118">Для выполнения следующих действий необходимо, чтобы модель была синхронизирована со схемой базы данных.</span><span class="sxs-lookup"><span data-stu-id="a339d-118">The following steps require the model to be in-sync with the database schema.</span></span>

## <a name="step-2-enable-migrations"></a><span data-ttu-id="a339d-119">Шаг 2. Включение миграции</span><span class="sxs-lookup"><span data-stu-id="a339d-119">Step 2: Enable Migrations</span></span>

<span data-ttu-id="a339d-120">Следующим шагом является включение миграции.</span><span class="sxs-lookup"><span data-stu-id="a339d-120">The next step is to enable migrations.</span></span> <span data-ttu-id="a339d-121">Это можно сделать, запустив команду " **включить миграцию** " в консоли диспетчера пакетов.</span><span class="sxs-lookup"><span data-stu-id="a339d-121">You can do this by running the **Enable-Migrations** command in Package Manager Console.</span></span>

<span data-ttu-id="a339d-122">Эта команда создаст папку в решении с именем Migrations и поместит в нее один класс с именем Configuration.</span><span class="sxs-lookup"><span data-stu-id="a339d-122">This command will create a folder in your solution called Migrations, and put a single class inside it called Configuration.</span></span> <span data-ttu-id="a339d-123">Класс конфигурации — это место настройки миграции для приложения. Дополнительные сведения см. в [Code First migrations](~/ef6/modeling/code-first/migrations/index.md) разделе.</span><span class="sxs-lookup"><span data-stu-id="a339d-123">The Configuration class is where you configure migrations for your application, you can find out more about it in the [Code First Migrations](~/ef6/modeling/code-first/migrations/index.md) topic.</span></span>

## <a name="step-3-add-an-initial-migration"></a><span data-ttu-id="a339d-124">Шаг 3. добавление начальной миграции</span><span class="sxs-lookup"><span data-stu-id="a339d-124">Step 3: Add an initial migration</span></span>

<span data-ttu-id="a339d-125">После создания и применения миграций к локальной базе данных может также потребоваться применить эти изменения к другим базам данных.</span><span class="sxs-lookup"><span data-stu-id="a339d-125">Once migrations have been created and applied to the local database you may also want to apply these changes to other databases.</span></span> <span data-ttu-id="a339d-126">Например, локальная база данных может быть тестовой базой данных, и в конечном итоге потребуется применить изменения к рабочей базе данных и (или) другим разработчикам тестовых баз данных.</span><span class="sxs-lookup"><span data-stu-id="a339d-126">For example, your local database may be a test database and you may ultimately want to also apply the changes to a production database and/or other developers test databases.</span></span> <span data-ttu-id="a339d-127">Существует два варианта этого шага, и тот, который следует выбрать, зависит от того, является ли схема любых других баз данных пустой или в текущий момент соответствует схеме локальной базы данных.</span><span class="sxs-lookup"><span data-stu-id="a339d-127">There are two options for this step and the one you should pick depends whether or not the schema of any other databases is empty or currently matches the schema of the local database.</span></span>

-   <span data-ttu-id="a339d-128">**Вариант 1. использование существующей схемы в качестве начальной точки.**</span><span class="sxs-lookup"><span data-stu-id="a339d-128">**Option One: Use existing schema as starting point.**</span></span> <span data-ttu-id="a339d-129">Этот подход следует использовать при условии, что в будущем для других баз данных, к которым будут применяться миграции, будет та же схема, что и в текущей базе данных.</span><span class="sxs-lookup"><span data-stu-id="a339d-129">You should use this approach when other databases that migrations will be applied to in the future will have the same schema as your local database currently has.</span></span> <span data-ttu-id="a339d-130">Например, вы можете использовать этот параметр, если локальная тестовая база данных в настоящее время соответствует версии 1 рабочей базы данных, и позже эти миграции будут применены для обновления рабочей базы данных до v2.</span><span class="sxs-lookup"><span data-stu-id="a339d-130">For example, you might use this if your local test database currently matches v1 of your production database and you will later apply these migrations to update your production database to v2.</span></span>
-   <span data-ttu-id="a339d-131">**Вариант 2. используйте пустую базу данных в качестве начальной точки.**</span><span class="sxs-lookup"><span data-stu-id="a339d-131">**Option Two: Use empty database as starting point.**</span></span> <span data-ttu-id="a339d-132">Этот подход следует использовать в том случае, если другие базы данных, к которым будут применяться миграции в будущем, будут пустыми (или еще не существовать).</span><span class="sxs-lookup"><span data-stu-id="a339d-132">You should use this approach when other databases that migrations will be applied to in the future are empty (or do not exist yet).</span></span> <span data-ttu-id="a339d-133">Например, вы можете использовать его, если вы начали разрабатывать приложение с помощью тестовой базы данных, но без использования миграций, и позднее потребуется создать рабочую базу данных с нуля.</span><span class="sxs-lookup"><span data-stu-id="a339d-133">For example, you might use this if you started developing your application using a test database but without using migrations and you will later want to create a production database from scratch.</span></span>

### <a name="option-one-use-existing-schema-as-a-starting-point"></a><span data-ttu-id="a339d-134">Вариант 1. использование существующей схемы в качестве отправной точки</span><span class="sxs-lookup"><span data-stu-id="a339d-134">Option One: Use existing schema as a starting point</span></span>

<span data-ttu-id="a339d-135">Code First Migrations использует моментальный снимок модели, сохраненной в самой последней миграции, для обнаружения изменений в модели (подробные сведения об этом см. в [Code First migrations в средах команд](~/ef6/modeling/code-first/migrations/teams.md)).</span><span class="sxs-lookup"><span data-stu-id="a339d-135">Code First Migrations uses a snapshot of the model stored in the most recent migration to detect changes to the model (you can find detailed information about this in [Code First Migrations in Team Environments](~/ef6/modeling/code-first/migrations/teams.md)).</span></span> <span data-ttu-id="a339d-136">Поскольку предполагается, что базы данных уже имеют схему текущей модели, будет создана пустая миграция (без операций), в которой текущая модель является моментальным снимком.</span><span class="sxs-lookup"><span data-stu-id="a339d-136">Since we are going to assume that databases already have the schema of the current model, we will generate an empty (no-op) migration that has the current model as a snapshot.</span></span>

1.  <span data-ttu-id="a339d-137">Выполните команду **Add-Migration InitialCreate – игноречанжес** в консоли диспетчера пакетов.</span><span class="sxs-lookup"><span data-stu-id="a339d-137">Run the **Add-Migration InitialCreate –IgnoreChanges** command in Package Manager Console.</span></span> <span data-ttu-id="a339d-138">При этом создается пустой перенос с текущей моделью в виде моментального снимка.</span><span class="sxs-lookup"><span data-stu-id="a339d-138">This creates an empty migration with the current model as a snapshot.</span></span>
2.  <span data-ttu-id="a339d-139">Выполните команду **обновления базы данных** в консоли диспетчера пакетов.</span><span class="sxs-lookup"><span data-stu-id="a339d-139">Run the **Update-Database** command in Package Manager Console.</span></span> <span data-ttu-id="a339d-140">Это приведет к применению InitialCreate миграции к базе данных.</span><span class="sxs-lookup"><span data-stu-id="a339d-140">This will apply the InitialCreate migration to the database.</span></span> <span data-ttu-id="a339d-141">Поскольку фактическая миграция не содержит каких-либо изменений, она просто добавляет строку в \_\_таблицу Мигратионшистори, указывающую, что эта миграция уже применена.</span><span class="sxs-lookup"><span data-stu-id="a339d-141">Since the actual migration doesn’t contain any changes, it will simply add a row to the \_\_MigrationsHistory table indicating that this migration has already been applied.</span></span>

### <a name="option-two-use-empty-database-as-a-starting-point"></a><span data-ttu-id="a339d-142">Вариант 2. используйте пустую базу данных в качестве отправной точки</span><span class="sxs-lookup"><span data-stu-id="a339d-142">Option Two: Use empty database as a starting point</span></span>

<span data-ttu-id="a339d-143">В этом сценарии необходимо выполнить миграцию, чтобы создать всю базу данных с нуля, включая таблицы, уже имеющиеся в нашей локальной базе данных.</span><span class="sxs-lookup"><span data-stu-id="a339d-143">In this scenario we need Migrations to be able to create the entire database from scratch – including the tables that are already present in our local database.</span></span> <span data-ttu-id="a339d-144">Мы создадим InitialCreate миграцию, которая включает логику для создания существующей схемы.</span><span class="sxs-lookup"><span data-stu-id="a339d-144">We’re going to generate an InitialCreate migration that includes logic to create the existing schema.</span></span> <span data-ttu-id="a339d-145">Теперь наша существующая база данных будет выглядеть так, как эта миграция уже была применена.</span><span class="sxs-lookup"><span data-stu-id="a339d-145">We’ll then make our existing database look like this migration has already been applied.</span></span>

1.  <span data-ttu-id="a339d-146">Выполните команду **Add-Migration InitialCreate** в консоли диспетчера пакетов.</span><span class="sxs-lookup"><span data-stu-id="a339d-146">Run the **Add-Migration InitialCreate** command in Package Manager Console.</span></span> <span data-ttu-id="a339d-147">Будет создана миграция для создания существующей схемы.</span><span class="sxs-lookup"><span data-stu-id="a339d-147">This creates a migration to create the existing schema.</span></span>
2.  <span data-ttu-id="a339d-148">Закомментируйте весь код в методе up созданной миграции.</span><span class="sxs-lookup"><span data-stu-id="a339d-148">Comment out all code in the Up method of the newly created migration.</span></span> <span data-ttu-id="a339d-149">Это позволит нам применить миграцию к локальной базе данных, не пытаясь повторно создавать все таблицы и т. д., которые уже существуют.</span><span class="sxs-lookup"><span data-stu-id="a339d-149">This will allow us to ‘apply’ the migration to the local database without trying to recreate all the tables etc. that already exist.</span></span>
3.  <span data-ttu-id="a339d-150">Выполните команду **обновления базы данных** в консоли диспетчера пакетов.</span><span class="sxs-lookup"><span data-stu-id="a339d-150">Run the **Update-Database** command in Package Manager Console.</span></span> <span data-ttu-id="a339d-151">Это приведет к применению InitialCreate миграции к базе данных.</span><span class="sxs-lookup"><span data-stu-id="a339d-151">This will apply the InitialCreate migration to the database.</span></span> <span data-ttu-id="a339d-152">Поскольку фактическая миграция не содержит каких-либо изменений (так как мы временно закомментируем их), она просто добавляет строку в \_\_таблицу Мигратионшистори, указывающую на то, что эта миграция уже применена.</span><span class="sxs-lookup"><span data-stu-id="a339d-152">Since the actual migration doesn’t contain any changes (because we temporarily commented them out), it will simply add a row to the \_\_MigrationsHistory table indicating that this migration has already been applied.</span></span>
4.  <span data-ttu-id="a339d-153">Отмена комментария к коду в методе up.</span><span class="sxs-lookup"><span data-stu-id="a339d-153">Un-comment the code in the Up method.</span></span> <span data-ttu-id="a339d-154">Это означает, что если миграция применяется к будущим базам данных, то схема, которая уже существовала в локальной базе данных, будет создана при миграции.</span><span class="sxs-lookup"><span data-stu-id="a339d-154">This means that when this migration is applied to future databases, the schema that already existed in the local database will be created by migrations.</span></span>

## <a name="things-to-be-aware-of"></a><span data-ttu-id="a339d-155">Вопросы, которые следует учитывать</span><span class="sxs-lookup"><span data-stu-id="a339d-155">Things to be aware of</span></span>

<span data-ttu-id="a339d-156">При использовании миграции к существующей базе данных необходимо учитывать некоторые моменты.</span><span class="sxs-lookup"><span data-stu-id="a339d-156">There are a few things you need to be aware of when using Migrations against an existing database.</span></span>

### <a name="defaultcalculated-names-may-not-match-existing-schema"></a><span data-ttu-id="a339d-157">Значения по умолчанию или вычисляемые имена не могут соответствовать существующей схеме</span><span class="sxs-lookup"><span data-stu-id="a339d-157">Default/calculated names may not match existing schema</span></span>

<span data-ttu-id="a339d-158">При миграции явно указываются имена столбцов и таблиц при формировании операций миграции.</span><span class="sxs-lookup"><span data-stu-id="a339d-158">Migrations explicitly specifies names for columns and tables when it scaffolds a migrations.</span></span> <span data-ttu-id="a339d-159">Однако существуют и другие объекты базы данных, которые используются при миграции для вычисления имени по умолчанию при применении миграции.</span><span class="sxs-lookup"><span data-stu-id="a339d-159">However, there are other database objects that Migrations calculates a default name for when applying the migrations.</span></span> <span data-ttu-id="a339d-160">Сюда входят индексы и ограничения внешнего ключа.</span><span class="sxs-lookup"><span data-stu-id="a339d-160">This includes indexes and foreign key constraints.</span></span> <span data-ttu-id="a339d-161">При нацеливании на существующую схему эти вычисляемые имена могут не совпадать с данными, которые действительно существуют в базе данных.</span><span class="sxs-lookup"><span data-stu-id="a339d-161">When targeting an existing schema, these calculated names may not match what actually exists in your database.</span></span>

<span data-ttu-id="a339d-162">Ниже приведены некоторые примеры того, когда необходимо помнить об этом.</span><span class="sxs-lookup"><span data-stu-id="a339d-162">Here are some examples of when you need to be aware of this:</span></span>

<span data-ttu-id="a339d-163">**Если вы использовали параметр "вариант 1: использовать существующую схему в качестве начальной точки" из шага 3:**</span><span class="sxs-lookup"><span data-stu-id="a339d-163">**If you used ‘Option One: Use existing schema as a starting point’ from Step 3:**</span></span>

-   <span data-ttu-id="a339d-164">Если будущие изменения в модели требуют изменения или удаления одного из объектов базы данных, названных по-другому, необходимо изменить шаблонную миграцию, указав правильное имя.</span><span class="sxs-lookup"><span data-stu-id="a339d-164">If future changes in your model require changing or dropping one of the database objects that is named differently, you will need to modify the scaffolded migration to specify the correct name.</span></span> <span data-ttu-id="a339d-165">API-интерфейсы миграции имеют необязательный параметр name, позволяющий сделать это.</span><span class="sxs-lookup"><span data-stu-id="a339d-165">The Migrations APIs have an optional Name parameter that allows you to do this.</span></span>
    <span data-ttu-id="a339d-166">Например, существующая схема может содержать таблицу Post со столбцом внешнего ключа Блогид, имеющего индекс с именем Индексфк\_Блогид.</span><span class="sxs-lookup"><span data-stu-id="a339d-166">For example, your existing schema may have a Post table with a BlogId foreign key column that has an index named IndexFk\_BlogId.</span></span> <span data-ttu-id="a339d-167">Однако миграция по умолчанию предполагает, что этот индекс будет называться IX\_Блогид.</span><span class="sxs-lookup"><span data-stu-id="a339d-167">However, by default Migrations would expect this index to be named IX\_BlogId.</span></span> <span data-ttu-id="a339d-168">При внесении изменений в модель, которая приводит к удалению этого индекса, необходимо изменить сформированный вызов событие DropIndex, указав имя Индексфк\_Блогид.</span><span class="sxs-lookup"><span data-stu-id="a339d-168">If you make a change to your model that results in dropping this index, you will need to modify the scaffolded DropIndex call to specify the IndexFk\_BlogId name.</span></span>

<span data-ttu-id="a339d-169">**Если вы использовали команду "параметр 2: использовать пустую базу данных как начальную точку" из шага 3:**</span><span class="sxs-lookup"><span data-stu-id="a339d-169">**If you used ‘Option Two: Use empty database as a starting point’ from Step 3:**</span></span>

-   <span data-ttu-id="a339d-170">Попытка запустить метод down первоначальной миграции (то есть возврат к пустой базе данных) в локальной базе данных может завершиться неудачей, так как при миграции будет предпринята попытка удалить индексы и ограничения внешнего ключа с использованием неверных имен.</span><span class="sxs-lookup"><span data-stu-id="a339d-170">Trying to run the Down method of the initial migration (that is, reverting to an empty database) against your local database may fail because Migrations will try to drop indexes and foreign key constraints using the incorrect names.</span></span> <span data-ttu-id="a339d-171">Это повлияет только на локальную базу данных, так как другие базы данных будут создаваться с нуля с помощью метода первоначальной миграции.</span><span class="sxs-lookup"><span data-stu-id="a339d-171">This will only affect your local database since other databases will be created from scratch using the Up method of the initial migration.</span></span>
    <span data-ttu-id="a339d-172">Если вы хотите понизить уровень существующей локальной базы данных до пустого состояния, проще всего сделать это вручную, удалив базу данных или удалив все таблицы.</span><span class="sxs-lookup"><span data-stu-id="a339d-172">If you want to downgrade your existing local database to an empty state it is easiest to do this manually, either by dropping the database or dropping all the tables.</span></span> <span data-ttu-id="a339d-173">После первоначального перехода все объекты базы данных будут созданы заново с именами по умолчанию, поэтому эта проблема не будет представлена повторно.</span><span class="sxs-lookup"><span data-stu-id="a339d-173">After this initial downgrade all database objects will be recreated with the default names, so this issue will not present itself again.</span></span>
-   <span data-ttu-id="a339d-174">Если будущие изменения в модели нуждаются в изменении или удалении одного из объектов базы данных, названных по-другому, это не будет работать для существующей локальной базы данных, так как имена не будут соответствовать значениям по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="a339d-174">If future changes in your model require changing or dropping one of the database objects that is named differently, this will not work against your existing local database – since the names won’t match the defaults.</span></span> <span data-ttu-id="a339d-175">Однако он будет работать с базами данных, созданными "с нуля", так как они будут использовать имена по умолчанию, выбранные при миграции.</span><span class="sxs-lookup"><span data-stu-id="a339d-175">However, it will work against databases that were created ‘from scratch’ since they will have used the default names chosen by Migrations.</span></span>
    <span data-ttu-id="a339d-176">Можно либо вручную внести эти изменения в локальную существующую базу данных, либо рассмотреть возможность повторного создания базы данных с нуля, так как она будет создана на других компьютерах.</span><span class="sxs-lookup"><span data-stu-id="a339d-176">You could either make these changes manually on your local existing database, or consider having Migrations recreate your database from scratch – as it will on other machines.</span></span>
-   <span data-ttu-id="a339d-177">Базы данных, созданные с помощью метода up начальной миграции, могут немного отличаться от локальной базы данных, так как будут использоваться вычисляемые имена по умолчанию для индексов и ограничения внешнего ключа.</span><span class="sxs-lookup"><span data-stu-id="a339d-177">Databases created using the Up method of your initial migration may differ slightly from the local database since the calculated default names for indexes and foreign key constraints will be used.</span></span> <span data-ttu-id="a339d-178">Кроме того, можно получить дополнительные индексы, так как миграция будет создавать индексы внешних ключевых столбцов по умолчанию — это может быть не так в исходной локальной базе данных.</span><span class="sxs-lookup"><span data-stu-id="a339d-178">You may also end up with extra indexes as Migrations will create indexes on foreign key columns by default – this may not have been the case in your original local database.</span></span>

### <a name="not-all-database-objects-are-represented-in-the-model"></a><span data-ttu-id="a339d-179">Не все объекты базы данных представлены в модели</span><span class="sxs-lookup"><span data-stu-id="a339d-179">Not all database objects are represented in the model</span></span>

<span data-ttu-id="a339d-180">Объекты базы данных, не являющиеся частью модели, не будут обрабатываться миграцией.</span><span class="sxs-lookup"><span data-stu-id="a339d-180">Database objects that are not part of your model will not be handled by Migrations.</span></span> <span data-ttu-id="a339d-181">Это могут быть представления, хранимые процедуры, разрешения, таблицы, не являющиеся частью модели, дополнительные индексы и т. д.</span><span class="sxs-lookup"><span data-stu-id="a339d-181">This can include views, stored procedures, permissions, tables that are not part of your model, additional indexes, etc.</span></span>

<span data-ttu-id="a339d-182">Ниже приведены некоторые примеры того, когда необходимо помнить об этом.</span><span class="sxs-lookup"><span data-stu-id="a339d-182">Here are some examples of when you need to be aware of this:</span></span>

-   <span data-ttu-id="a339d-183">Независимо от варианта, выбранного на шаге 3, если будущие изменения в модели нуждаются в изменении или удалении этих дополнительных объектов, миграция не будет затруднить внесение этих изменений.</span><span class="sxs-lookup"><span data-stu-id="a339d-183">Regardless of the option you chose in ‘Step 3’, if future changes in your model require changing or dropping these additional objects Migrations will not know to make these changes.</span></span> <span data-ttu-id="a339d-184">Например, если удалить столбец с дополнительным индексом, то при миграции не будет известно, что он удаляет индекс.</span><span class="sxs-lookup"><span data-stu-id="a339d-184">For example, if you drop a column that has an additional index on it, Migrations will not know to drop the index.</span></span> <span data-ttu-id="a339d-185">Его необходимо будет добавить в шаблон миграции вручную.</span><span class="sxs-lookup"><span data-stu-id="a339d-185">You will need to manually add this to the scaffolded Migration.</span></span>
-   <span data-ttu-id="a339d-186">При использовании параметра "вариант 2: использовать пустую базу данных в качестве начальной точки" эти дополнительные объекты не будут созданы методом первоначальной миграции.</span><span class="sxs-lookup"><span data-stu-id="a339d-186">If you used ‘Option Two: Use empty database as a starting point’, these additional objects will not be created by the Up method of your initial migration.</span></span>
    <span data-ttu-id="a339d-187">При необходимости вы можете изменить методы up и Down, чтобы позаботиться об этих дополнительных объектах.</span><span class="sxs-lookup"><span data-stu-id="a339d-187">You can modify the Up and Down methods to take care of these additional objects if you wish.</span></span> <span data-ttu-id="a339d-188">Для объектов, которые изначально не поддерживаются в API-интерфейсе миграции (например, представления), можно использовать метод [SQL](https://msdn.microsoft.com/library/system.data.entity.migrations.dbmigration.sql.aspx) для выполнения необработанных операций SQL для их создания или удаления.</span><span class="sxs-lookup"><span data-stu-id="a339d-188">For objects that are not natively supported in the Migrations API – such as views – you can use the [Sql](https://msdn.microsoft.com/library/system.data.entity.migrations.dbmigration.sql.aspx) method to run raw SQL to create/drop them.</span></span>
