---
title: Использование программы Migrate. exe-EF6
author: divega
ms.date: 10/23/2016
ms.assetid: 989ea862-e936-4c85-926a-8cfbef5df5b8
ms.openlocfilehash: 34866ddbbf81f090a064af148a612dd354ae9401
ms.sourcegitcommit: 7a709ce4f77134782393aa802df5ab2718714479
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/04/2019
ms.locfileid: "74824809"
---
# <a name="using-migrateexe"></a>Использование программы Migrate. exe
Code First Migrations можно использовать для обновления базы данных в Visual Studio, но ее также можно выполнить с помощью программы командной строки Migrate. exe. На этой странице дается краткий обзор использования программы Migration. exe для выполнения миграции в базе данных.

> [!NOTE]
> В этой статье предполагается, что вы умеете использовать Code First Migrations в основных сценариях. В противном случае необходимо прочитать [Code First migrations](~/ef6/modeling/code-first/migrations/index.md) , прежде чем продолжить.

## <a name="copy-migrateexe"></a>Копировать файл migrate. exe

При установке Entity Framework с помощью NuGet Migrate. exe будет находиться в папке Tools скачанного пакета. В папке проекта &lt;&gt;\\пакеты\\EntityFramework. средства \\&gt;&lt;версии

После завершения миграции. exe необходимо скопировать его в расположение сборки, содержащей миграции.

Если приложение предназначено для .NET 4, а не 4,5, необходимо скопировать **файл Redirect. config** в расположение, а затем переименовать файл **Migrate. exe. config**. Это необходимо для того, чтобы программа Migrate. exe вынаправляла правильные перенаправления привязки, чтобы иметь возможность нахождение сборки Entity Framework.

| .NET 4.5                                      | .NET 4,0                                      |
|:----------------------------------------------|:----------------------------------------------|
| ![Файлы .NET 4,5](~/ef6/media/net45files.png) | ![Файлы .NET 4,0](~/ef6/media/net40files.png) |

> [!NOTE]
> Программа Migrate. exe не поддерживает 64-разрядные сборки.

После перемещения файла Migration. exe в нужную папку вы сможете использовать его для выполнения миграции в базе данных. Вся программа предназначена для выполнения миграции. Он не может создавать миграции или создавать скрипты SQL.

## <a name="see-options"></a>См. параметры

``` console
Migrate.exe /?
```

В вышеуказанном примере отображается страница справки, связанная с этой служебной программой. чтобы это работало, необходимо иметь файл EntityFramework. dll в том же расположении, где выполняется миграция. exe.

## <a name="migrate-to-the-latest-migration"></a>Переход на последнюю версию миграции

``` console
Migrate.exe MyMvcApplication.dll /startupConfigurationFile="..\\web.config"
```

При запуске программы Migration. exe единственным обязательным параметром является сборка, которая содержит сборку, содержащую выполняемые миграции, но при этом будут использоваться все параметры на основе соглашения, если не указать файл конфигурации.

## <a name="migrate-to-a-specific-migration"></a>Переход на определенную миграцию

``` console
Migrate.exe MyApp.exe /startupConfigurationFile="MyApp.exe.config" /targetMigration="AddTitle"
```

Если требуется выполнить миграцию до определенной миграции, можно указать имя миграции. Это приведет к выполнению всех предыдущих миграций по мере необходимости, пока не будет указана миграция.

## <a name="specify-working-directory"></a>Укажите рабочий каталог

``` console
Migrate.exe MyApp.exe /startupConfigurationFile="MyApp.exe.config" /startupDirectory="c:\\MyApp"
```

Если сборка имеет зависимости или считывает файлы относительно рабочего каталога, необходимо задать Стартупдиректори.

## <a name="specify-migration-configuration-to-use"></a>Укажите конфигурацию миграции для использования

``` console
Migrate.exe MyAssembly CustomConfig /startupConfigurationFile="..\\web.config"
```

При наличии нескольких классов конфигурации миграции, наследующих классы от Дбмигратионконфигуратион, необходимо указать, какой из них будет использоваться для этого выполнения. Это указывается путем предоставления необязательного второго параметра без параметра, как описано выше.

## <a name="provide-connection-string"></a>Укажите строку подключения

``` console
Migrate.exe BlogDemo.dll /connectionString="Data Source=localhost;Initial Catalog=BlogDemo;Integrated Security=SSPI" /connectionProviderName="System.Data.SqlClient"
```

Если вы хотите указать строку подключения в командной строке, необходимо также указать имя поставщика. Если не указать имя поставщика, будет вызвано исключение.

## <a name="common-problems"></a>Распространенные проблемы

| Сообщение об ошибке                                                                                                                                                                                                                                                                                                                      | Решение                                                                                                                                                                                                                                                                                             |
|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Необработанное исключение: System. IO. FileLoadException: не удалось загрузить файл или сборку "EntityFramework, Version = 5.0.0.0, Culture = Neutral, PublicKeyToken = b77a5c561934e089»" или одну из его зависимостей. Определение манифеста найденной сборки не соответствует ссылке на сборку. (Исключение из HRESULT: 0x80131040)         | Обычно это означает, что вы используете приложение .NET 4 без файла Redirect. config. Необходимо скопировать файл Redirect. config в то же расположение, что и Migrate. exe, и переименовать его в файл migrate. exe. config.                                                                                       |
| Необработанное исключение: System. IO. FileLoadException: не удалось загрузить файл или сборку "EntityFramework, Version = 4.4.0.0, Culture = Neutral, PublicKeyToken = b77a5c561934e089»" или одну из его зависимостей. Определение манифеста найденной сборки не соответствует ссылке на сборку. (Исключение из HRESULT: 0x80131040)          | Это исключение означает, что вы используете приложение .NET 4,5 с параметром Redirect. config, скопированным в расположение Migrate. exe. Если приложение является .NET 4,5, то нет необходимости иметь файл конфигурации с перенаправлениями внутри. Удалите файл migrate. exe. config.                                    |
| Ошибка: не удалось обновить базу данных в соответствии с текущей моделью, так как имеются ожидающие изменения и отключена автоматическая миграция. Либо запишите ожидающие изменения модели в перенос на основе кода, либо включите автоматическую миграцию. Задайте для Дбмигратионсконфигуратион. Аутоматикмигратионсенаблед значение true, чтобы включить автоматическую миграцию. | Эта ошибка возникает при выполнении миграции, если вы еще не создавали миграцию на работу с изменениями, внесенными в модель, и база данных не соответствует модели. Примером этого является добавление свойства к классу модели, а затем выполняется миграция. exe без создания миграции для обновления базы данных. |
| Ошибка: тип не разрешен для члена "System. Data. Entity. migrations. Design. Тулингфакаде + Упдатеруннер, EntityFramework, Version = 5.0.0.0, Culture = Neutral, PublicKeyToken = b77a5c561934e089»".                                                                                                                                       | Эта ошибка может быть вызвана указанием неправильного каталога запуска. Это должно быть расположение файла Migrate. exe                                                                                                                                                                                      |
| Необработанное исключение: System. NullReferenceException: ссылка на объект не задана экземпляром объекта. <br/>   в System. Data. Entity. migrations. Console. Program. Main (строка [] args)                                                                                                                                             | Это может быть вызвано тем, что не указан обязательный параметр для используемого сценария. Например, указание строки подключения без указания имени поставщика.                                                                                                                        |
| Ошибка: в сборке "ClassLibrary1" обнаружено более одного типа конфигурации миграции. Укажите имя используемого объекта.                                                                                                                                                                                                  | Как указано в ошибке, в данной сборке имеется несколько классов конфигурации. Для указания используемого параметра необходимо использовать параметр/Конфигуратионтипе.                                                                                                                                           |
| Ошибка: не удалось загрузить файл или сборку "&lt;assemblyName&gt;" или одну из ее зависимостей. Данное имя сборки или база кода были недопустимыми. (Исключение из HRESULT: 0x80131047)                                                                                                                                                    | Это может быть вызвано неправильным указанием имени сборки                                                                                                                                                                                                                          |
| Ошибка: не удалось загрузить файл или сборку "&lt;assemblyName&gt;" или одну из ее зависимостей. Была сделана попытка загрузить программу, имеющую неверный формат.                                                                                                                                                                          | Это происходит, если вы пытаетесь запустить программу Migrate. exe для приложения x64. EF 5,0 и ниже будут работать только на платформе x86.                                                                                                                                                                                |
