---
title: Использование программы Migrate. exe-EF6
author: divega
ms.date: 10/23/2016
ms.assetid: 989ea862-e936-4c85-926a-8cfbef5df5b8
ms.openlocfilehash: 34866ddbbf81f090a064af148a612dd354ae9401
ms.sourcegitcommit: cc0ff36e46e9ed3527638f7208000e8521faef2e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78415673"
---
# <a name="using-migrateexe"></a><span data-ttu-id="c94f4-102">Использование программы Migrate. exe</span><span class="sxs-lookup"><span data-stu-id="c94f4-102">Using migrate.exe</span></span>
<span data-ttu-id="c94f4-103">Code First Migrations можно использовать для обновления базы данных в Visual Studio, но ее также можно выполнить с помощью программы командной строки Migrate. exe.</span><span class="sxs-lookup"><span data-stu-id="c94f4-103">Code First Migrations can be used to update a database from inside visual studio, but can also be executed via the command line tool migrate.exe.</span></span> <span data-ttu-id="c94f4-104">На этой странице дается краткий обзор использования программы Migration. exe для выполнения миграции в базе данных.</span><span class="sxs-lookup"><span data-stu-id="c94f4-104">This page will give a quick overview on how to use migrate.exe to execute migrations against a database.</span></span>

> [!NOTE]
> <span data-ttu-id="c94f4-105">В этой статье предполагается, что вы умеете использовать Code First Migrations в основных сценариях.</span><span class="sxs-lookup"><span data-stu-id="c94f4-105">This article assumes you know how to use Code First Migrations in basic scenarios.</span></span> <span data-ttu-id="c94f4-106">В противном случае необходимо прочитать [Code First migrations](~/ef6/modeling/code-first/migrations/index.md) , прежде чем продолжить.</span><span class="sxs-lookup"><span data-stu-id="c94f4-106">If you don’t, then you’ll need to read [Code First Migrations](~/ef6/modeling/code-first/migrations/index.md) before continuing.</span></span>

## <a name="copy-migrateexe"></a><span data-ttu-id="c94f4-107">Копировать файл migrate. exe</span><span class="sxs-lookup"><span data-stu-id="c94f4-107">Copy migrate.exe</span></span>

<span data-ttu-id="c94f4-108">При установке Entity Framework с помощью NuGet Migrate. exe будет находиться в папке Tools скачанного пакета.</span><span class="sxs-lookup"><span data-stu-id="c94f4-108">When you install Entity Framework using NuGet migrate.exe will be inside the tools folder of the downloaded package.</span></span> <span data-ttu-id="c94f4-109">В папке проекта &lt;&gt;\\пакеты\\EntityFramework. средства \\&gt;&lt;версии</span><span class="sxs-lookup"><span data-stu-id="c94f4-109">In &lt;project folder&gt;\\packages\\EntityFramework.&lt;version&gt;\\tools</span></span>

<span data-ttu-id="c94f4-110">После завершения миграции. exe необходимо скопировать его в расположение сборки, содержащей миграции.</span><span class="sxs-lookup"><span data-stu-id="c94f4-110">Once you have migrate.exe then you need to copy it to the location of the assembly that contains your migrations.</span></span>

<span data-ttu-id="c94f4-111">Если приложение предназначено для .NET 4, а не 4,5, необходимо скопировать **файл Redirect. config** в расположение, а затем переименовать файл **Migrate. exe. config**. Это необходимо для того, чтобы программа Migrate. exe вынаправляла правильные перенаправления привязки, чтобы иметь возможность нахождение сборки Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="c94f4-111">If your application targets .NET 4, and not 4.5, then you will need to copy the **Redirect.config** into the location as well and rename it **migrate.exe.config**. This is so that migrate.exe gets the correct binding redirects to be able to locate the Entity Framework assembly.</span></span>

| <span data-ttu-id="c94f4-112">.NET 4.5</span><span class="sxs-lookup"><span data-stu-id="c94f4-112">.NET 4.5</span></span>                                      | <span data-ttu-id="c94f4-113">.NET 4,0</span><span class="sxs-lookup"><span data-stu-id="c94f4-113">.NET 4.0</span></span>                                      |
|:----------------------------------------------|:----------------------------------------------|
| ![Файлы .NET 4,5](~/ef6/media/net45files.png) | ![Файлы .NET 4,0](~/ef6/media/net40files.png) |

> [!NOTE]
> <span data-ttu-id="c94f4-116">Программа Migrate. exe не поддерживает 64-разрядные сборки.</span><span class="sxs-lookup"><span data-stu-id="c94f4-116">migrate.exe doesn't support x64 assemblies.</span></span>

<span data-ttu-id="c94f4-117">После перемещения файла Migration. exe в нужную папку вы сможете использовать его для выполнения миграции в базе данных.</span><span class="sxs-lookup"><span data-stu-id="c94f4-117">Once you have moved migrate.exe to the correct folder then you should be able to use it to execute migrations against the database.</span></span> <span data-ttu-id="c94f4-118">Вся программа предназначена для выполнения миграции.</span><span class="sxs-lookup"><span data-stu-id="c94f4-118">All the utility is designed to do is execute migrations.</span></span> <span data-ttu-id="c94f4-119">Он не может создавать миграции или создавать скрипты SQL.</span><span class="sxs-lookup"><span data-stu-id="c94f4-119">It cannot generate migrations or create a SQL script.</span></span>

## <a name="see-options"></a><span data-ttu-id="c94f4-120">См. параметры</span><span class="sxs-lookup"><span data-stu-id="c94f4-120">See options</span></span>

``` console
Migrate.exe /?
```

<span data-ttu-id="c94f4-121">В вышеуказанном примере отображается страница справки, связанная с этой служебной программой. чтобы это работало, необходимо иметь файл EntityFramework. dll в том же расположении, где выполняется миграция. exe.</span><span class="sxs-lookup"><span data-stu-id="c94f4-121">The above will display the help page associated with this utility, note that you will need to have the EntityFramework.dll in the same location that you are running migrate.exe in order for this to work.</span></span>

## <a name="migrate-to-the-latest-migration"></a><span data-ttu-id="c94f4-122">Переход на последнюю версию миграции</span><span class="sxs-lookup"><span data-stu-id="c94f4-122">Migrate to the latest migration</span></span>

``` console
Migrate.exe MyMvcApplication.dll /startupConfigurationFile="..\\web.config"
```

<span data-ttu-id="c94f4-123">При запуске программы Migration. exe единственным обязательным параметром является сборка, которая содержит сборку, содержащую выполняемые миграции, но при этом будут использоваться все параметры на основе соглашения, если не указать файл конфигурации.</span><span class="sxs-lookup"><span data-stu-id="c94f4-123">When running migrate.exe the only mandatory parameter is the assembly, which is the assembly that contains the migrations that you are trying to run, but it will use all convention based settings if you do not specify the configuration file.</span></span>

## <a name="migrate-to-a-specific-migration"></a><span data-ttu-id="c94f4-124">Переход на определенную миграцию</span><span class="sxs-lookup"><span data-stu-id="c94f4-124">Migrate to a specific migration</span></span>

``` console
Migrate.exe MyApp.exe /startupConfigurationFile="MyApp.exe.config" /targetMigration="AddTitle"
```

<span data-ttu-id="c94f4-125">Если требуется выполнить миграцию до определенной миграции, можно указать имя миграции.</span><span class="sxs-lookup"><span data-stu-id="c94f4-125">If you want to run migrations up to a specific migration, then you can specify the name of the migration.</span></span> <span data-ttu-id="c94f4-126">Это приведет к выполнению всех предыдущих миграций по мере необходимости, пока не будет указана миграция.</span><span class="sxs-lookup"><span data-stu-id="c94f4-126">This will run all previous migrations as required until getting to the migration specified.</span></span>

## <a name="specify-working-directory"></a><span data-ttu-id="c94f4-127">Укажите рабочий каталог</span><span class="sxs-lookup"><span data-stu-id="c94f4-127">Specify working directory</span></span>

``` console
Migrate.exe MyApp.exe /startupConfigurationFile="MyApp.exe.config" /startupDirectory="c:\\MyApp"
```

<span data-ttu-id="c94f4-128">Если сборка имеет зависимости или считывает файлы относительно рабочего каталога, необходимо задать Стартупдиректори.</span><span class="sxs-lookup"><span data-stu-id="c94f4-128">If you assembly has dependencies or reads files relative to the working directory then you will need to set startupDirectory.</span></span>

## <a name="specify-migration-configuration-to-use"></a><span data-ttu-id="c94f4-129">Укажите конфигурацию миграции для использования</span><span class="sxs-lookup"><span data-stu-id="c94f4-129">Specify migration configuration to use</span></span>

``` console
Migrate.exe MyAssembly CustomConfig /startupConfigurationFile="..\\web.config"
```

<span data-ttu-id="c94f4-130">При наличии нескольких классов конфигурации миграции, наследующих классы от Дбмигратионконфигуратион, необходимо указать, какой из них будет использоваться для этого выполнения.</span><span class="sxs-lookup"><span data-stu-id="c94f4-130">If you have multiple migration configuration classes, classes inheriting from DbMigrationConfiguration, then you need to specify which is to be used for this execution.</span></span> <span data-ttu-id="c94f4-131">Это указывается путем предоставления необязательного второго параметра без параметра, как описано выше.</span><span class="sxs-lookup"><span data-stu-id="c94f4-131">This is specified by providing the optional second parameter without a switch as above.</span></span>

## <a name="provide-connection-string"></a><span data-ttu-id="c94f4-132">Укажите строку подключения</span><span class="sxs-lookup"><span data-stu-id="c94f4-132">Provide connection string</span></span>

``` console
Migrate.exe BlogDemo.dll /connectionString="Data Source=localhost;Initial Catalog=BlogDemo;Integrated Security=SSPI" /connectionProviderName="System.Data.SqlClient"
```

<span data-ttu-id="c94f4-133">Если вы хотите указать строку подключения в командной строке, необходимо также указать имя поставщика.</span><span class="sxs-lookup"><span data-stu-id="c94f4-133">If you wish to specify a connection string at the command line then you must also provide the provider name.</span></span> <span data-ttu-id="c94f4-134">Если не указать имя поставщика, будет вызвано исключение.</span><span class="sxs-lookup"><span data-stu-id="c94f4-134">Not specifying the provider name will cause an exception.</span></span>

## <a name="common-problems"></a><span data-ttu-id="c94f4-135">Распространенные проблемы</span><span class="sxs-lookup"><span data-stu-id="c94f4-135">Common Problems</span></span>

| <span data-ttu-id="c94f4-136">Сообщение об ошибке</span><span class="sxs-lookup"><span data-stu-id="c94f4-136">Error Message</span></span>                                                                                                                                                                                                                                                                                                                      | <span data-ttu-id="c94f4-137">Решение</span><span class="sxs-lookup"><span data-stu-id="c94f4-137">Solution</span></span>                                                                                                                                                                                                                                                                                             |
|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="c94f4-138">Необработанное исключение: System. IO. FileLoadException: не удалось загрузить файл или сборку "EntityFramework, Version = 5.0.0.0, Culture = Neutral, PublicKeyToken = b77a5c561934e089»" или одну из его зависимостей.</span><span class="sxs-lookup"><span data-stu-id="c94f4-138">Unhandled Exception: System.IO.FileLoadException:  Could not load file or assembly 'EntityFramework, Version=5.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089' or one of its dependencies.</span></span> <span data-ttu-id="c94f4-139">Определение манифеста найденной сборки не соответствует ссылке на сборку.</span><span class="sxs-lookup"><span data-stu-id="c94f4-139">The located assembly's manifest definition does not match the assembly reference.</span></span> <span data-ttu-id="c94f4-140">(Исключение из HRESULT: 0x80131040)</span><span class="sxs-lookup"><span data-stu-id="c94f4-140">(Exception from HRESULT: 0x80131040)</span></span>         | <span data-ttu-id="c94f4-141">Обычно это означает, что вы используете приложение .NET 4 без файла Redirect. config.</span><span class="sxs-lookup"><span data-stu-id="c94f4-141">This typically means that you are running a .NET 4 application without the Redirect.config file.</span></span> <span data-ttu-id="c94f4-142">Необходимо скопировать файл Redirect. config в то же расположение, что и Migrate. exe, и переименовать его в файл migrate. exe. config.</span><span class="sxs-lookup"><span data-stu-id="c94f4-142">You need to copy the Redirect.config to the same location as migrate.exe and rename it to migrate.exe.config.</span></span>                                                                                       |
| <span data-ttu-id="c94f4-143">Необработанное исключение: System. IO. FileLoadException: не удалось загрузить файл или сборку "EntityFramework, Version = 4.4.0.0, Culture = Neutral, PublicKeyToken = b77a5c561934e089»" или одну из его зависимостей.</span><span class="sxs-lookup"><span data-stu-id="c94f4-143">Unhandled Exception: System.IO.FileLoadException: Could not load file or assembly 'EntityFramework, Version=4.4.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089' or one of its dependencies.</span></span> <span data-ttu-id="c94f4-144">Определение манифеста найденной сборки не соответствует ссылке на сборку.</span><span class="sxs-lookup"><span data-stu-id="c94f4-144">The located assembly's manifest definition does not match the assembly reference.</span></span> <span data-ttu-id="c94f4-145">(Исключение из HRESULT: 0x80131040)</span><span class="sxs-lookup"><span data-stu-id="c94f4-145">(Exception from HRESULT: 0x80131040)</span></span>          | <span data-ttu-id="c94f4-146">Это исключение означает, что вы используете приложение .NET 4,5 с параметром Redirect. config, скопированным в расположение Migrate. exe.</span><span class="sxs-lookup"><span data-stu-id="c94f4-146">This exception means that you are running a .NET 4.5 application with the Redirect.config copied to the migrate.exe location.</span></span> <span data-ttu-id="c94f4-147">Если приложение является .NET 4,5, то нет необходимости иметь файл конфигурации с перенаправлениями внутри.</span><span class="sxs-lookup"><span data-stu-id="c94f4-147">If your app is .NET 4.5 then you do not need to have the config file with the redirects inside.</span></span> <span data-ttu-id="c94f4-148">Удалите файл migrate. exe. config.</span><span class="sxs-lookup"><span data-stu-id="c94f4-148">Delete the migrate.exe.config file.</span></span>                                    |
| <span data-ttu-id="c94f4-149">Ошибка: не удалось обновить базу данных в соответствии с текущей моделью, так как имеются ожидающие изменения и отключена автоматическая миграция.</span><span class="sxs-lookup"><span data-stu-id="c94f4-149">ERROR: Unable to update database to match the current model because there are pending changes and automatic migration is disabled.</span></span> <span data-ttu-id="c94f4-150">Либо запишите ожидающие изменения модели в перенос на основе кода, либо включите автоматическую миграцию.</span><span class="sxs-lookup"><span data-stu-id="c94f4-150">Either write the pending model changes to a code-based migration or enable automatic migration.</span></span> <span data-ttu-id="c94f4-151">Задайте для Дбмигратионсконфигуратион. Аутоматикмигратионсенаблед значение true, чтобы включить автоматическую миграцию.</span><span class="sxs-lookup"><span data-stu-id="c94f4-151">Set DbMigrationsConfiguration.AutomaticMigrationsEnabled to true to enable automatic migration.</span></span> | <span data-ttu-id="c94f4-152">Эта ошибка возникает при выполнении миграции, если вы еще не создавали миграцию на работу с изменениями, внесенными в модель, и база данных не соответствует модели.</span><span class="sxs-lookup"><span data-stu-id="c94f4-152">This error occurs if running migrate when you haven’t created a migration to cope with changes made to the model, and the database does not match the model.</span></span> <span data-ttu-id="c94f4-153">Примером этого является добавление свойства к классу модели, а затем выполняется миграция. exe без создания миграции для обновления базы данных.</span><span class="sxs-lookup"><span data-stu-id="c94f4-153">Adding a property to a model class then running migrate.exe without creating a migration to upgrade the database is an example of this.</span></span> |
| <span data-ttu-id="c94f4-154">Ошибка: тип не разрешен для члена "System. Data. Entity. migrations. Design. Тулингфакаде + Упдатеруннер, EntityFramework, Version = 5.0.0.0, Culture = Neutral, PublicKeyToken = b77a5c561934e089»".</span><span class="sxs-lookup"><span data-stu-id="c94f4-154">ERROR: Type is not resolved for member 'System.Data.Entity.Migrations.Design.ToolingFacade+UpdateRunner,EntityFramework, Version=5.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.</span></span>                                                                                                                                       | <span data-ttu-id="c94f4-155">Эта ошибка может быть вызвана указанием неправильного каталога запуска.</span><span class="sxs-lookup"><span data-stu-id="c94f4-155">This error can be caused by specifying an incorrect startup directory.</span></span> <span data-ttu-id="c94f4-156">Это должно быть расположение файла Migrate. exe</span><span class="sxs-lookup"><span data-stu-id="c94f4-156">This must be the location of migrate.exe</span></span>                                                                                                                                                                                      |
| <span data-ttu-id="c94f4-157">Необработанное исключение: System. NullReferenceException: ссылка на объект не задана экземпляром объекта.</span><span class="sxs-lookup"><span data-stu-id="c94f4-157">Unhandled Exception: System.NullReferenceException: Object reference not set to an instance of an object.</span></span> <br/>   <span data-ttu-id="c94f4-158">в System. Data. Entity. migrations. Console. Program. Main (строка [] args)</span><span class="sxs-lookup"><span data-stu-id="c94f4-158">at System.Data.Entity.Migrations.Console.Program.Main(String[] args)</span></span>                                                                                                                                             | <span data-ttu-id="c94f4-159">Это может быть вызвано тем, что не указан обязательный параметр для используемого сценария.</span><span class="sxs-lookup"><span data-stu-id="c94f4-159">This can be caused by not specifying a required parameter for a scenario that you are using.</span></span> <span data-ttu-id="c94f4-160">Например, указание строки подключения без указания имени поставщика.</span><span class="sxs-lookup"><span data-stu-id="c94f4-160">For example specifying a connection string without specifying the provider name.</span></span>                                                                                                                        |
| <span data-ttu-id="c94f4-161">Ошибка: в сборке "ClassLibrary1" обнаружено более одного типа конфигурации миграции.</span><span class="sxs-lookup"><span data-stu-id="c94f4-161">ERROR: More than one migrations configuration type was found in the assembly 'ClassLibrary1'.</span></span> <span data-ttu-id="c94f4-162">Укажите имя используемого объекта.</span><span class="sxs-lookup"><span data-stu-id="c94f4-162">Specify the name of the one to use.</span></span>                                                                                                                                                                                                  | <span data-ttu-id="c94f4-163">Как указано в ошибке, в данной сборке имеется несколько классов конфигурации.</span><span class="sxs-lookup"><span data-stu-id="c94f4-163">As the error states, there is more than one configuration class in the given assembly.</span></span> <span data-ttu-id="c94f4-164">Для указания используемого параметра необходимо использовать параметр/Конфигуратионтипе.</span><span class="sxs-lookup"><span data-stu-id="c94f4-164">You must use the /configurationType switch to specify which to use.</span></span>                                                                                                                                           |
| <span data-ttu-id="c94f4-165">Ошибка: не удалось загрузить файл или сборку "&lt;assemblyName&gt;" или одну из ее зависимостей.</span><span class="sxs-lookup"><span data-stu-id="c94f4-165">ERROR: Could not load file or assembly ‘&lt;assemblyName&gt;’ or one of its dependencies.</span></span> <span data-ttu-id="c94f4-166">Данное имя сборки или база кода были недопустимыми.</span><span class="sxs-lookup"><span data-stu-id="c94f4-166">The given assembly name or codebase was invalid.</span></span> <span data-ttu-id="c94f4-167">(Исключение из HRESULT: 0x80131047)</span><span class="sxs-lookup"><span data-stu-id="c94f4-167">(Exception from HRESULT: 0x80131047)</span></span>                                                                                                                                                    | <span data-ttu-id="c94f4-168">Это может быть вызвано неправильным указанием имени сборки</span><span class="sxs-lookup"><span data-stu-id="c94f4-168">This can be caused by specifying an assembly name incorrectly or not having</span></span>                                                                                                                                                                                                                          |
| <span data-ttu-id="c94f4-169">Ошибка: не удалось загрузить файл или сборку "&lt;assemblyName&gt;" или одну из ее зависимостей.</span><span class="sxs-lookup"><span data-stu-id="c94f4-169">ERROR: Could not load file or assembly ‘&lt;assemblyName&gt;' or one of its dependencies.</span></span> <span data-ttu-id="c94f4-170">Была сделана попытка загрузить программу, имеющую неверный формат.</span><span class="sxs-lookup"><span data-stu-id="c94f4-170">An attempt was made to load a program with an incorrect format.</span></span>                                                                                                                                                                          | <span data-ttu-id="c94f4-171">Это происходит, если вы пытаетесь запустить программу Migrate. exe для приложения x64.</span><span class="sxs-lookup"><span data-stu-id="c94f4-171">This happens if you are trying to run migrate.exe against an x64 application.</span></span> <span data-ttu-id="c94f4-172">EF 5,0 и ниже будут работать только на платформе x86.</span><span class="sxs-lookup"><span data-stu-id="c94f4-172">EF 5.0 and below will only work on x86.</span></span>                                                                                                                                                                                |
