---
title: Разделение сущностей конструктора — EF6
author: divega
ms.date: 10/23/2016
ms.assetid: aa2dd48a-1f0e-49dd-863d-d6b4f5834832
ms.openlocfilehash: ba1895ae491cec909ff88a8784eea82f1876f595
ms.sourcegitcommit: cc0ff36e46e9ed3527638f7208000e8521faef2e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78415265"
---
# <a name="designer-entity-splitting"></a>Разделение сущностей конструктора
В этом пошаговом руководстве показано, как сопоставлять тип сущности с двумя таблицами путем изменения модели с помощью Entity Framework Designer (конструктор EF). Сущность можно сопоставить с несколькими таблицами, если в таблицах имеется общий ключ. Понятия, применяемые для сопоставления типа сущности с двумя таблицами, легко расширяются для сопоставления типа сущности с более чем двумя таблицами.

На следующем рисунке показаны основные окна, используемые при работе с конструктором EF.

![Конструктор EF](~/ef6/media/efdesigner.png)

## <a name="prerequisites"></a>предварительные требования

Visual Studio 2012 или Visual Studio 2010, Ultimate, Premium, Professional или Web Express Edition.

## <a name="create-the-database"></a>Создание базы данных

Сервер базы данных, который устанавливается вместе с Visual Studio, отличается в зависимости от версии Visual Studio, которую вы установили:

-   Если вы используете Visual Studio 2012, то будете создавать базу данных LocalDB.
-   Если вы используете Visual Studio 2010, вы создадите базу данных SQL Express.

Сначала мы создадим базу данных с двумя таблицами, которые мы будем объединять в одну сущность.

-   Запустите Visual Studio
-   **Просмотр —&gt; обозреватель сервера**
-   Щелкните правой кнопкой мыши **подключения к данным —&gt; добавить подключение...**
-   Если вы не подключились к базе данных из обозреватель сервера, прежде чем нужно будет выбрать **Microsoft SQL Server** в качестве источника данных
-   Подключение к LocalDB или SQL Express в зависимости от того, какой из установленных служб
-   Введите **ентитисплиттинг** в качестве имени базы данных
-   Нажмите кнопку **ОК** , и появится запрос на создание новой базы данных, выберите **Да** .
-   Теперь новая база данных появится в обозреватель сервера
-   Если вы используете Visual Studio 2012
    -   Щелкните правой кнопкой мыши базу данных в обозреватель сервера и выберите **создать запрос** .
    -   Скопируйте следующий SQL в новый запрос, щелкните запрос правой кнопкой мыши и выберите команду **выполнить** .
-   Если вы используете Visual Studio 2010
    -   Выберите **данные —&gt; редактор SQL,&gt; создать соединение с запросом...**
    -   Введите **.\\SQLExpress** в качестве имени сервера и нажмите кнопку **ОК** .
    -   Выберите базу данных **ентитисплиттинг** в раскрывающемся списке в верхней части редактора запросов.
    -   Скопируйте следующий SQL в новый запрос, щелкните запрос правой кнопкой мыши и выберите команду **выполнить SQL** .

``` SQL
CREATE TABLE [dbo].[Person] (
[PersonId] INT IDENTITY (1, 1) NOT NULL,
[FirstName] NVARCHAR (200) NULL,
[LastName] NVARCHAR (200) NULL,
CONSTRAINT [PK_Person] PRIMARY KEY CLUSTERED ([PersonId] ASC)
);

CREATE TABLE [dbo].[PersonInfo] (
[PersonId] INT NOT NULL,
[Email] NVARCHAR (200) NULL,
[Phone] NVARCHAR (50) NULL,
CONSTRAINT [PK_PersonInfo] PRIMARY KEY CLUSTERED ([PersonId] ASC),
CONSTRAINT [FK_Person_PersonInfo] FOREIGN KEY ([PersonId]) REFERENCES [dbo].[Person] ([PersonId]) ON DELETE CASCADE
);
```

## <a name="create-the-project"></a>Создание проекта

-   В меню **Файл** укажите **Создать**, затем нажмите **Проект**.
-   В левой области щелкните **Visual C\#** , а затем выберите шаблон **консольное приложение** .
-   Введите **мапентититотаблессампле** в качестве имени проекта и нажмите кнопку **ОК**.
-   Если будет предложено сохранить SQL запрос, созданный в первом разделе, нажмите кнопку **нет** .

## <a name="create-a-model-based-on-the-database"></a>Создание модели на основе базы данных

-   Щелкните правой кнопкой мыши имя проекта в обозреватель решений, наведите указатель на пункт **Добавить**и выберите пункт **новый элемент**.
-   Выберите **данные** в меню слева, а затем выберите **ADO.NET EDM** в области Шаблоны.
-   Введите **мапентититотаблесмодел. EDMX** в поле имя файла и нажмите кнопку **Добавить**.
-   В диалоговом окне Выбор содержимого модели выберите пункт **создать из базы данных**, а затем нажмите кнопку **Далее.**
-   Выберите подключение **ентитисплиттинг** в раскрывающемся списке и нажмите кнопку **Далее**.
-   В диалоговом окне Выбор объектов базы данных установите флажок рядом с узлом **таблицы** .
    Это приведет к добавлению всех таблиц из базы данных **ентитисплиттинг** в модель.
-   Нажмите кнопку **Готово**.

Отобразится Entity Designer, предоставляющий область конструктора для редактирования модели.

## <a name="map-an-entity-to-two-tables"></a>Сопоставьте сущность с двумя таблицами

На этом шаге мы будем обновлять тип сущности **Person** , чтобы объединить данные из таблиц **Person** и **персонинфо** .

-   Выберите  **электронной почты** и свойства **телефона** сущности **персонинфо **и нажмите клавиши **CTRL + X** .
-   Выберите сущность **Person **и нажмите клавиши **CTRL + V** .
-   В области конструктора выберите сущность **персонинфо** и нажмите кнопку **Delete (удалить** ) на клавиатуре.
-   Нажмите кнопку **нет** при появлении запроса на удаление таблицы **персонинфо** из модели, мы будем сопоставлять ее с сущностью **Person** .

    ![Удаление таблиц](~/ef6/media/deletetables.png)

Для дальнейших действий требуется окно **сведения о сопоставлении** . Если это окно не отображается, щелкните правой кнопкой мыши область конструктора и выберите пункт **сведения о сопоставлении**.

-   Выберите тип сущности **Person** и нажмите кнопку **&lt;добавить таблицу или представление&gt;**  в окне **сведения о сопоставлении** .
-   Выберите **персонинфо ** из раскрывающегося списка.
    Окно **сведения о Сопоставлении** обновляется с сопоставлением столбцов по умолчанию, но для нашего сценария это нормально.

Тип сущности **person** теперь сопоставлен с таблицами **Person** и **персонинфо** .

![Сопоставление 2](~/ef6/media/mapping2.png)

## <a name="use-the-model"></a>Использование модели

-   Вставьте следующий код в метод Main.

``` csharp
    using (var context = new EntitySplittingEntities())
    {
        var person = new Person
        {
            FirstName = "John",
            LastName = "Doe",
            Email = "john@example.com",
            Phone = "555-555-5555"
        };

        context.People.Add(person);
        context.SaveChanges();

        foreach (var item in context.People)
        {
            Console.WriteLine(item.FirstName);
        }
    }
```

-   Скомпилируйте и запустите приложение.

Следующие инструкции T-SQL были выполнены в базе данных в результате выполнения этого приложения. 

-   Следующие две инструкции **INSERT** были выполнены в результате выполнения context. SaveChanges (). Они принимают данные из сущности **Person** и разбивают их между таблицами **Person** и **персонинфо** .

    ![Вставить 1](~/ef6/media/insert1.png)

    ![Вставить 2](~/ef6/media/insert2.png)
-   Следующая операция **SELECT** была выполнена в результате перечисления пользователей в базе данных. Он сочетает данные из таблицы **Person** и **персонинфо** .

    ![Выберите пункт](~/ef6/media/select.png)
